;/*FB_PKG_DELIM*/

__d("CPXComposerConstants",[],(function(a,b,c,d,e,f){"use strict";a=120;b=68;c=90;d=160;e=10;var g=4;f.THUMBNAIL_WIDTH=a;f.THUMBNAIL_HEIGHT=b;f.REEL_THUMBNAIL_WIDTH=c;f.REEL_THUMBNAIL_HEIGHT=d;f.NUM_OF_THUMBNAILS=e;f.MAX_NUM_THUMBNAILS=g}),66);
__d("CanvasToBlobImpl",["BlobFactory"],(function(a,b,c,d,e,f){function a(a,c){a=atob(a.substr(a.indexOf(",")+1));var d=new Uint8Array(a.length);for(var e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return b("BlobFactory").getBlob([d],{type:c})}e.exports={getBlob:a}}),null);
__d("VideoThumbnail_UNTYPED",["invariant"],(function(a,b,c,d,e,f,g){a=function(){"use strict";function a(a){this.$1=a}var b=a.prototype;b.getURL=function(){return this.$1};b.getData=function(){g(0,4844)};a.addTextToCanvasContext=function(a,b,c,d,e,f,g,h,i){a.fillStyle=h;a.textAlign=i;a.font=f+"px "+g;h=i==="center"?d+e/2:d;g=1;i=b.split("\n");for(d=i,b=Array.isArray(d),i=0,d=b?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(b){if(i>=d.length)break;j=d[i++]}else{i=d.next();if(i.done)break;j=i.value}j=j;var k="",l="";j=j.split(" ");for(var j=j,m=Array.isArray(j),n=0,j=m?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=j.length)break;o=j[n++]}else{n=j.next();if(n.done)break;o=n.value}o=o;l+=o;var p=a.measureText(l).width,q=a.measureText(o).width;if(q>e){k.length>0&&(a.fillText(k,h,c+f*g),g++);q="";var r="";for(var s=o,t=Array.isArray(s),u=0,s=t?s:s[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var v;if(t){if(u>=s.length)break;v=s[u++]}else{u=s.next();if(u.done)break;v=u.value}v=v;r+=v;var w=a.measureText(r).width;w>e?(a.fillText(q,h,c+f*g),q=v,r=v,g++):q=r}k=q+" ";l=q+" "}else p>e?(a.fillText(k,h,c+f*g),k=o+" ",l=o+" ",g++):(l+=" ",k=l)}a.fillText(k,h,c+f*g);g++}return a};return a}();e.exports=a}),null);
__d("dataURLToBlob",["BlobFactory","CanvasToBlobImpl","CanvasToBlobResource","Promise","WebWorker"],(function(a,b,c,d,e,f,g){var h,i=a.URL||a.webkitURL||{};function e(a,e){if(!i.createObjectURL||!c("BlobFactory").isSupported)return(h||(h=b("Promise"))).reject("Browser doesn't support this feature");if(c("WebWorker").isSupported())return new(h||(h=b("Promise")))(function(b,d){var f=new(c("WebWorker"))(c("CanvasToBlobResource")).setMessageHandler(function(a){b(a),f.terminate()}).setErrorHandler(function(a){d(a.message),f.terminate()}).execute().postMessage({dataURL:a,fileType:e})});else return(h||(h=b("Promise"))).resolve(d("CanvasToBlobImpl").getBlob(a,e))}g["default"]=e}),98);
__d("canvasToBlob",["Promise","dataURLToBlob","promiseDone"],(function(a,b,c,d,e,f,g){var h;function a(a,d,e){return new(h||(h=b("Promise")))(function(b,f){if(a.toBlob)a.toBlob(b,d,e);else{var g=a.toDataURL(d,e);c("promiseDone")(c("dataURLToBlob")(g,d).then(function(a){b(a)},f))}})}g["default"]=a}),98);
__d("CanvasVideoThumbnail",["EventListener","Promise","VideoThumbnail_UNTYPED","canvasToBlob","promiseDone"],(function(a,b,c,d,e,f,g){var h;a=function(a){babelHelpers.inheritsLoose(d,a);function d(b,c,d,e,f,g,h){var i;e===void 0&&(e=null);f===void 0&&(f=null);g===void 0&&(g=0);h===void 0&&(h=0);i=a.call(this,null)||this;i.$CanvasVideoThumbnail$p_1=b;i.$CanvasVideoThumbnail$p_2=c;i.$CanvasVideoThumbnail$p_3=d;i.$CanvasVideoThumbnail$p_4=e;i.$CanvasVideoThumbnail$p_5=f;i.$CanvasVideoThumbnail$p_6=g;i.$CanvasVideoThumbnail$p_7=h;i.$CanvasVideoThumbnail$p_8=i.$CanvasVideoThumbnail$p_1.toDataURL("image/jpeg");return i}var e=d.prototype;e.getCanvas=function(){return this.$CanvasVideoThumbnail$p_1};e.getTime=function(){return this.$CanvasVideoThumbnail$p_3?this.$CanvasVideoThumbnail$p_3:0};e.getURL=function(){this.$CanvasVideoThumbnail$p_8||(this.$CanvasVideoThumbnail$p_8=this.$CanvasVideoThumbnail$p_1.toDataURL("image/jpeg"));return this.$CanvasVideoThumbnail$p_8};e.getData=function(){var a=this,d=document.createElement("canvas"),e=d.getContext("2d"),f=this.$CanvasVideoThumbnail$p_2;return new(h||(h=b("Promise")))(function(b,g){var h=c("EventListener").listen(f,"seeked",function(){h.remove(),a.$CanvasVideoThumbnail$p_9(d,e),c("promiseDone")(c("canvasToBlob")(d,"image/jpeg").then(b,g))});f.currentTime=a.$CanvasVideoThumbnail$p_3})};e.getDataWithText=function(a,d,e,f,g,i,j,k){var l=this,m=document.createElement("canvas"),n=m.getContext("2d"),o=this.$CanvasVideoThumbnail$p_2;return new(h||(h=b("Promise")))(function(b,h){var p=c("EventListener").listen(o,"seeked",function(){p.remove(),n.fillStyle=j,n.textAlign=k,l.$CanvasVideoThumbnail$p_9(m,n),n=c("VideoThumbnail_UNTYPED").addTextToCanvasContext(n,a,d,e,f,g,i,j,k),c("promiseDone")(c("canvasToBlob")(m,"image/jpeg").then(b,h))});o.currentTime=l.$CanvasVideoThumbnail$p_3})};e.$CanvasVideoThumbnail$p_9=function(a,b){var c=this.$CanvasVideoThumbnail$p_2;this.$CanvasVideoThumbnail$p_4||this.$CanvasVideoThumbnail$p_5?(a.width=this.$CanvasVideoThumbnail$p_4?this.$CanvasVideoThumbnail$p_4:c.videoWidth,a.height=this.$CanvasVideoThumbnail$p_5?this.$CanvasVideoThumbnail$p_5:c.videoHeight,this.$CanvasVideoThumbnail$p_10(a,b)):(a.width=c.videoWidth,a.height=c.videoHeight,b.drawImage(c,0,0,a.width,a.height))};e.$CanvasVideoThumbnail$p_10=function(a,b){var c=this.$CanvasVideoThumbnail$p_2,d=this.$CanvasVideoThumbnail$p_6,e=this.$CanvasVideoThumbnail$p_7,f=this.$CanvasVideoThumbnail$p_4?this.$CanvasVideoThumbnail$p_4:a.width,g=this.$CanvasVideoThumbnail$p_5?this.$CanvasVideoThumbnail$p_5:a.height;b.drawImage(c,d,e,f,g,0,0,a.width,a.height)};return d}(c("VideoThumbnail_UNTYPED"));g["default"]=a}),98);
__d("HTMLMediaElementReadyStates",[],(function(a,b,c,d,e,f){a={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4};b=a;f["default"]=b}),66);
__d("IGDComposerEmojiPickerPopover.react",["IGDSPopover.react","JSResourceForInteraction","lazyLoadComponent","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("lazyLoadComponent")(c("JSResourceForInteraction")("IGDComposerEmojiPicker.react").__setRef("IGDComposerEmojiPickerPopover.react"));function a(a){var b=d("react-compiler-runtime").c(8),e=a.closeAfterSelect,f=a.onClose,g=a.onSelect,h=a.showPopoverArrow;a=a.threadKey;var k;b[0]!==e||b[1]!==f||b[2]!==g||b[3]!==a?(k=i.jsx(j,{closeAfterSelect:e,onClose:f,onSelect:g,threadKey:a}),b[0]=e,b[1]=f,b[2]=g,b[3]=a,b[4]=k):k=b[4];e=k;b[5]!==e||b[6]!==h?(f=i.jsx(c("IGDSPopover.react"),{popoverContent:e,popoverName:"emojiTray",withArrow:h}),b[5]=e,b[6]=h,b[7]=f):f=b[7];return f}g["default"]=a}),98);
__d("useIGDBroadcastChannelImpressionLoggerWithCheck",["MWCMThreadTypes.react","promiseDone","react","react-compiler-runtime","useIGDBroadcastChannelLogger","useSinglePartialViewImpression"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(a,b,e){var f=d("react-compiler-runtime").c(6),g=c("useIGDBroadcastChannelLogger")(a);f[0]!==g||f[1]!==e||f[2]!==b?(a=function(){b!=null&&d("MWCMThreadTypes.react").isIGBroadcastChannelThread(b)&&c("promiseDone")(g(e))},f[0]=g,f[1]=e,f[2]=b,f[3]=a):a=f[3];a=a;var h;f[4]!==a?(h={onImpressionStart:a},f[4]=a,f[5]=h):h=f[5];return c("useSinglePartialViewImpression")(h)}g["default"]=a}),98);
__d("IGDMessageContextMenuItem.react",["IGDSContextMenuItem.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={container:{paddingBottom:"xwib8y2",paddingEnd:"x1sxyh0",paddingStart:"xurb0ha",paddingTop:"x1y1aw1k",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(7),c=a.delimiter,e=a.icon,f=a.label,g=a.labelProps,h=a.onClick;a=a.testid;var k;b[0]!==c||b[1]!==e||b[2]!==f||b[3]!==g||b[4]!==h||b[5]!==a?(k=i.jsx(d("IGDSContextMenuItem.react").IGDSContextMenuItem,{addOnEnd:e,delimiter:c,onPress:h,testid:void 0,title:f,titleProps:g,xstyle:j.container}),b[0]=c,b[1]=e,b[2]=f,b[3]=g,b[4]=h,b[5]=a,b[6]=k):k=b[6];return k}g["default"]=a}),98);
__d("useIGDTriggerEditAction.react",["MAWEditMessageContext.react","MWPReplyContext.react","MessengerWebUXLogger","react","react-compiler-runtime","react-forget-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;b.useContext;function a(a,b,e){var f=d("react-compiler-runtime").c(10),g=c("MessengerWebUXLogger").useInteractionLogger(),h=d("react-forget-runtime").useContextWithBailoutExperiment__unstable(d("MAWEditMessageContext.react").Context,j),k=h.setEditMessageData;h=d("react-forget-runtime").useContextWithBailoutExperiment__unstable(d("MWPReplyContext.react").MWPReplyContext,i);var l=h.clearReply,m=h.reply;f[0]!==l||f[1]!==g||f[2]!==a.messageId||f[3]!==a.threadKey||f[4]!==a.timestampMs||f[5]!==e||f[6]!==m||f[7]!==k||f[8]!==b?(h=function(){m!=null&&l(a.threadKey,!0),k({messageId:a.messageId,threadKey:a.threadKey,threadType:b,timestampMs:a.timestampMs}),g==null?void 0:g({eventName:"edit_message_tap"}),e==null?void 0:e()},f[0]=l,f[1]=g,f[2]=a.messageId,f[3]=a.threadKey,f[4]=a.timestampMs,f[5]=e,f[6]=m,f[7]=k,f[8]=b,f[9]=h):h=f[9];return h}function i(a){return[a.clearReply,a.reply]}function j(a){return[a.setEditMessageData]}g["default"]=a}),98);
__d("useMWIsContactRestricted",["LSContactBitOffset"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a!=null&&d("LSContactBitOffset").has(66,a);return a}g["default"]=a}),98);
__d("useMWPCanUserEditMessage",["I64","LSAuthorityLevel","LSContactBitOffset","LSHotEmojiSize","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWThreadCutover","MWMessageDeliveryStatus","MWPActor.react","ReQL","ReQLSuspense","getIsMessageTimeBelowEditThreshold","gkx","isDeliveryStatusErrorState","isMWBumpMessage","isStringNullOrEmpty","mwCMIsAnyCMThread","mwCMIsCMSubthread","useMWGetOtherUserContact","useMWIsContactRestricted","useReStore","useServerTime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=5;function a(a,b,e){var g,m,n,o=d("MWPActor.react").useActor(),p=(j||(j=c("useReStore")))(),q=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(p.tables.attachments).getKeyRange(a.threadKey,a.messageId)},[p,a.messageId,a.threadKey],f.id+":65"),r=c("useMWGetOtherUserContact")(a.threadKey,b.threadType,d("LSContactBitOffset").contactCapabilityFields);r=c("useMWIsContactRestricted")(r);e=d("MAWThreadCutover").useIsCutoverOpenThread(e);var s=c("useServerTime")();if(c("isDeliveryStatusErrorState")(d("MWMessageDeliveryStatus").getFromSendStatus(a.sendStatusV2)))return!1;if(b==null)return!1;g=(h||(h=d("I64"))).to_int32((g=a.editCount)!=null?g:(h||(h=d("I64"))).zero)<k;s=d("getIsMessageTimeBelowEditThreshold").getIsMessageTimeBelowEditThreshold(h.of_float(s.getTime()),a.timestampMs);o=h.equal(a.senderId,o);m=(m=a.isForwarded)!=null?m:!1;var t=a.text!=null&&a.text!=="";n=h.equal((n=a.hotEmojiSize)!=null?n:(h||(h=d("I64"))).zero,(i||(i=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").NONE));q=((q=q==null?void 0:q.hasXma)!=null?q:!1)||!c("isStringNullOrEmpty")(a.mentionIds);var u=a.isUnsent===!1&&(h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)),v=c("isMWBumpMessage")(a);return g&&s&&o&&t&&n&&!m&&!e&&!q&&u&&!r&&!v&&l(b)}function l(a){var b=a.threadType;if(d("LSMessagingThreadTypeUtil").isWorkThread(a.threadSubtype))return!1;if(d("LSMessagingThreadTypeUtil").isArmadilloSecure(b))return!0;if(d("LSMessagingThreadTypeUtil").isJoinedDiscoverablePublicBroadcastChannel(b))return!0;if(c("mwCMIsAnyCMThread")(b)||c("mwCMIsCMSubthread")(b))return d("LSThreadBitOffset").has(194,a)&&c("gkx")("7675");return d("LSMessagingThreadTypeUtil").isOpenFnFThread(a)?!0:!1}g["default"]=a}),98);
__d("useIGDEditMessageMenuItem.react",["fbt","I64","IGDInstamadilloUtils","IGDMessageContextMenuItem.react","IGDSEditPanoOutline24Icon.react","MWPActor.react","gkx","qex","react","react-compiler-runtime","useIGDTriggerEditAction.react","useMWPCanUserEditMessage"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||d("react");function a(a,b,e){var f=d("react-compiler-runtime").c(4),g=c("qex")._("887")===!0&&!d("IGDInstamadilloUtils").isInstamadilloMessage(a)||c("gkx")("3688"),i=d("MWPActor.react").useActor(),l=a.senderId;l=(j||(j=d("I64"))).equal(l,i);var m=c("useIGDTriggerEditAction.react")(a,e.threadType,b);i=c("useMWPCanUserEditMessage")(a,e);if(!g||!l||!i)return null;f[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=h._("__JHASH__ASoNWZMk4ee__JHASH__"),f[0]=b):b=f[0];a=b;f[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=k.jsx(c("IGDSEditPanoOutline24Icon.react"),{alt:a,size:18}),f[1]=e):e=f[1];f[2]!==m?(g=k.jsx(c("IGDMessageContextMenuItem.react"),{icon:e,label:a,onClick:function(){m()},testid:void 0}),f[2]=m,f[3]=g):g=f[3];return g}g["default"]=a}),226);
__d("IGDSCopyPanoOutline24Icon.react",["IGDSSVGIconBase.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3),e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=i.jsx("path",{d:"m20.12 4.707-2.826-2.828A3.026 3.026 0 0 0 15.17 1h-5.167A3.007 3.007 0 0 0 7 4.004V5h-.996A3.007 3.007 0 0 0 3 8.004v11.992A3.007 3.007 0 0 0 6.004 23h7.992A3.007 3.007 0 0 0 17 19.996V19h.996A3.007 3.007 0 0 0 21 15.996V6.83a2.98 2.98 0 0 0-.88-2.123ZM18.586 6 16 6.001V3.414L18.586 6ZM15 19.996C15 20.55 14.55 21 13.996 21H6.004C5.45 21 5 20.55 5 19.996V8.004C5 7.45 5.45 7 6.004 7H7v8.996A3.007 3.007 0 0 0 10.004 19H15v.996ZM17.996 17h-7.992C9.45 17 9 16.55 9 15.996V4.004C9 3.45 9.45 3 10.004 3H14v3.001A2 2 0 0 0 15.999 8H19v7.996C19 16.55 18.55 17 17.996 17Z"}),b[0]=e):e=b[0];b[1]!==a?(e=i.jsx(c("IGDSSVGIconBase.react"),babelHelpers["extends"]({},a,{viewBox:"0 0 24 24",children:e})),b[1]=a,b[2]=e):e=b[2];return e}b=i.memo(a);g["default"]=b}),98);
__d("useIGDMessageCopyMenuItem.react",["fbt","Clipboard","I64","IGDMessageContextMenuItem.react","IGDSCopyPanoOutline24Icon.react","IGDThreadListNewMessageLoggingDataContext","Int64Hooks","LSIntEnum","LSMessageReplySourceTypeV2","MWPActor.react","MessengerWebUXLogger","getInstamadilloLoggingExtraData","promiseDone","react","react-compiler-runtime","requireDeferred","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m=l||d("react"),n=c("requireDeferred")("MWLogMessageAction").__setRef("useIGDMessageCopyMenuItem.react");function a(a,b,e){var f=d("react-compiler-runtime").c(16),g=(i||(i=c("useReStore")))(),l=d("MWPActor.react").useActor(),o=c("MessengerWebUXLogger").useInteractionLogger(),p=d("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),q=a.displayedContentTypes,r=a.replySourceTypeV2!=null&&(j||(j=d("LSIntEnum"))).toNumber(a.replySourceTypeV2)===c("LSMessageReplySourceTypeV2").FORWARD;q=(k||(k=d("I64"))).equal(q,(j||(j=d("LSIntEnum"))).ofNumber(1))||(k||(k=d("I64"))).equal(q,(j||(j=d("LSIntEnum"))).ofNumber(1033));q=q||r&&!!a.text;var s;f[0]!==l||f[1]!==g||f[2]!==p||f[3]!==o||f[4]!==a.messageId||f[5]!==a.senderId||f[6]!==a.text||f[7]!==a.threadKey||f[8]!==b||f[9]!==e?(r=function(){var f;o==null?void 0:o({eventName:"message_copy",extraData:c("getInstamadilloLoggingExtraData")(e),flowInstanceId:p});d("Clipboard").copy((f=a.text)!=null?f:"");b();n.onReady(function(b){return c("promiseDone")(b.log(g,a.messageId,a.threadKey,"message_dot_menu","copy",void 0,void 0,void 0,a.senderId,void 0,l))})},s=[l,g,p,o,a.messageId,a.senderId,a.text,a.threadKey,b,e],f[0]=l,f[1]=g,f[2]=p,f[3]=o,f[4]=a.messageId,f[5]=a.senderId,f[6]=a.text,f[7]=a.threadKey,f[8]=b,f[9]=e,f[10]=r,f[11]=s):(r=f[10],s=f[11]);r=d("Int64Hooks").useCallbackInt64(r,s);if(!q)return null;f[12]===Symbol["for"]("react.memo_cache_sentinel")?(s=h._("__JHASH__3LRiqsZl3CP__JHASH__"),f[12]=s):s=f[12];q=s;f[13]===Symbol["for"]("react.memo_cache_sentinel")?(s=m.jsx(c("IGDSCopyPanoOutline24Icon.react"),{alt:q,size:18}),f[13]=s):s=f[13];f[14]!==r?(s=m.jsx(c("IGDMessageContextMenuItem.react"),{icon:s,label:q,onClick:r}),f[14]=r,f[15]=s):s=f[15];return s}g["default"]=a}),226);
__d("MAWDocumentPreProcess",["Promise","WABlobToArrayBuffer","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["start document preprocess"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["start optimistic document preprocess"]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["MAWAudioPreProcess"]);function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){k.DEV(i());return(h||(h=b("Promise"))).resolve({file:a,filename:a.name,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(a):null,type:"document"})});return l.apply(this,arguments)}function f(c){k.DEV(j());var d=a.URL.createObjectURL(c);return(h||(h=b("Promise"))).resolve({file:c,filename:c.name,type:"document",url:d})}g.documentPreprocess=e;g.optimisticDocumentPreprocess=f}),98);
__d("MAWFetchXMAData_LinkPreviewQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="8406450339459389"}),null);
__d("MAWFetchXMAData_LinkPreviewQuery.graphql",["MAWFetchXMAData_LinkPreviewQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"maxPreviewHeight"},c={defaultValue:null,kind:"LocalArgument",name:"maxPreviewWidth"},d={defaultValue:null,kind:"LocalArgument",name:"url"},e=[{alias:null,args:[{fields:[{kind:"Variable",name:"maxPreviewHeight",variableName:"maxPreviewHeight"},{kind:"Variable",name:"maxPreviewWidth",variableName:"maxPreviewWidth"},{kind:"Variable",name:"url",variableName:"url"}],kind:"ObjectValue",name:"params"}],kind:"ScalarField",name:"post_reshare_xma",storageKey:null}];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"MAWFetchXMAData_LinkPreviewQuery",selections:e,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[d,c,a],kind:"Operation",name:"MAWFetchXMAData_LinkPreviewQuery",selections:e},params:{id:b("MAWFetchXMAData_LinkPreviewQuery_facebookRelayOperation"),metadata:{},name:"MAWFetchXMAData_LinkPreviewQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MAWGetImageSpec",["MAWImageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function c(b,c){var e=a.URL.createObjectURL(b);return d("MAWImageUtils").urlToFile(e,(e=c)!=null?e:b.type).then(function(a){var b=a.height;a=a.width;return{height:b,width:a}})}function e(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=a.URL.createObjectURL(b);var c=(yield d("MAWImageUtils").urlToImageSpec(b));a.URL.revokeObjectURL(b);return c});return h.apply(this,arguments)}g.getImageSpec_DEPRECATED=c;g.getImageSpec=e}),98);
__d("MAWUnshimUrl",["CometLinkShimUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return void 0;var b=d("CometLinkShimUtils").getLinkShimInfo(a,void 0,void 0,void 0,void 0,!0);return!b.shimmed?a:b.unshimmedHref}g.unshimUrl=a}),98);
__d("MAWFetchXMAData",["fbt","CometRelay","ConstUriUtils","FBLogger","LSXmaContentType","MAWFetchXMABlob","MAWFetchXMAData_LinkPreviewQuery.graphql","MAWGetImageSpec","MAWParseXMAFBConfig","MAWUnshimUrl","Promise","WAArmadilloXMA.pb","asyncToGeneratorRuntime","qex","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k={failed_to_fetch_blob_for_xma_share:"Failed to fetch blob xma data for MAWShareAttachent",failed_to_fetch_json_for_xma_share:"Failed execute MAWShareAttachment_LinkPreviewQuery for MAWShareAttachent",failed_to_parse_json_for_xma_share:"Failed to fetch blob xma data for MAWShareAttachent"};function l(a){return{defaultCTA:{actionUrl:d("MAWUnshimUrl").unshimUrl(a),buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:d("MAWUnshimUrl").unshimUrl(a),title:h._("__JHASH__l7kNV274w6c__JHASH__").toString()},linkType:"internal",overlayIconGlyph:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE,preview_blob:void 0,title_text:h._("__JHASH__2usVu04y012__JHASH__").toString()}}function m(a){var b=Object.entries(c("LSXmaContentType")).find(function(b){var c=b[0];b=b[1];return a===b&&d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE[c]!=null});b=b!=null?d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE[b[0]]:void 0;if(b===void 0)return void 0;if(!d("MAWParseXMAFBConfig").isFBSupportedTargetType(b)){c("FBLogger")("messenger_web_sharing").mustfix("Unsupported XMA Target Type in sending path: "+b);return d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE}return b}function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g;try{g=JSON.parse(e)}catch(a){throw c("FBLogger")("messenger_web_sharing").catching(a).mustfixThrow(k.failed_to_parse_json_for_xma_share)}e=g;var h=e.action_url,i=e.ctas,l=e.default_cta_title,n=e.favicon_url,o=e.header_image_url,p=e.header_title,q=e.image_url,r=e.preview_url,s=e.subtitle_text,t=e.title_text;e=e.xma_content_type;var u=e;e=(yield (j||(j=b("Promise"))).all([[(n==null?void 0:n.startsWith("ls"))===!0?null:n,"favicon"],[q,"image"],[r,"preview"],[o,"header_image"]].map(function(a){return d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"MAWFetchXMAData_"+a[1],url:a[0],xmaContentType:u}).then(function(a){return(a=a)!=null?a:void 0})}))["catch"](function(a){f.forEach(function(a){d("sendToSentQPLLogger").markSendToSentFail(a,"failed_to_fetch_blob_for_xma_share")});c("FBLogger")("messenger_web_sharing").catching(a).mustfix(k.failed_to_fetch_blob_for_xma_share);return[void 0,void 0,void 0,void 0]}));n=e[0];q=e[1];r=e[2];o=e[3];e=i;i=m(u);var v=e==null?void 0:e[0];h=d("MAWUnshimUrl").unshimUrl((h=(h=h)!=null?h:v==null?void 0:v.action_url)!=null?h:a);a=d("MAWUnshimUrl").unshimUrl((v==null?void 0:v.native_url)!=null&&(v==null?void 0:v.native_url)!==""?v==null?void 0:v.native_url:h);h={actionUrl:h,buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:a,title:(v=l)!=null?v:void 0};return{ctas:e==null?void 0:e.map(function(a){return{actionUrl:d("MAWUnshimUrl").unshimUrl(a.action_url!=null&&a.action_url!==""?a.action_url:void 0),buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:d("MAWUnshimUrl").unshimUrl(a.native_url!=null&&a.native_url!==""?a.native_url:void 0),title:(a=a.title)!=null?a:void 0}}),defaultCTA:h,favicon_blob:n,header_image_blob:o,header_title:(a=p)!=null?a:void 0,image_blob:q,linkType:"internal",preview_blob:r,subtitle_text:(l=s)!=null?l:void 0,title_text:(v=t)!=null?v:void 0,xma_message_type:i}});return o.apply(this,arguments)}function p(a,e){return d("CometRelay").fetchQuery(a,i!==void 0?i:i=b("MAWFetchXMAData_LinkPreviewQuery.graphql"),{maxPreviewHeight:(a=c("qex")._("226"))!=null?a:void 0,maxPreviewWidth:(a=c("qex")._("226"))!=null?a:void 0,url:e}).toPromise()}function a(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){b=d("ConstUriUtils").getUri(b);b=b==null?void 0:(b=b.setSubDomain("www"))==null?void 0:b.toString();if(b==null)return{linkType:"unknown"};e.forEach(function(a){d("sendToSentQPLLogger").markSendToSentPoint(a,"fetch_json_for_xma_share_start")});a=(yield p(a,b)["catch"](function(a){e.forEach(function(b){d("sendToSentQPLLogger").markSendToSentFail(b,"failed_to_fetch_json_for_xma_share",a)}),c("FBLogger")("messenger_web_sharing").catching(a).mustfix(k.failed_to_fetch_json_for_xma_share)}));e.forEach(function(a){d("sendToSentQPLLogger").markSendToSentPoint(a,"fetch_json_for_xma_share_end")});if(a==null){e.forEach(function(a){d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{xma_data_result:"empty"}})});return{linkType:"unknown"}}a=a.post_reshare_xma;if(a==null){e.forEach(function(a){d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{xma_data_result:"external"}})});return{linkType:"external"}}if(a==="private"){e.forEach(function(a){d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{xma_data_result:"private"}})});return l(b)}e.forEach(function(a){d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{xma_data_result:"public"}})});return n(b,a,e)});return q.apply(this,arguments)}function e(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=a.favicon_blob,f=a.header_image_blob,g=a.overlayIconGlyph;a=a.preview_blob;a=a==null?void 0:new File([a],"preview",{type:a.type});e=e==null?void 0:new File([e],"favicon",{type:e.type});f=f==null?void 0:new File([f],"header",{type:f.type});g=g===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE?(j||(j=b("Promise"))).resolve({height:2,width:2}):a!=null?d("MAWGetImageSpec").getImageSpec_DEPRECATED(a):(j||(j=b("Promise"))).resolve();var h=e!=null?d("MAWGetImageSpec").getImageSpec_DEPRECATED(e):(j||(j=b("Promise"))).resolve(),i=f!=null?d("MAWGetImageSpec").getImageSpec_DEPRECATED(f):(j||(j=b("Promise"))).resolve();g=(yield (j||(j=b("Promise"))).all([g,h,i]));h=g[0];i=g[1];g=g[2];d("sendToSentQPLLogger").markSendToSentPoint(c,"preview_favicon_spec_ready");c=a==null||h==null?void 0:{file:a,height:h.height,width:h.width};a=e==null||i==null?void 0:{file:e,height:i.height,width:i.width};h=f==null||g==null?void 0:{file:f,height:g.height,width:g.width};return{faviconFileArgs:a,headerImageFileArgs:h,previewFileArgs:c}});return r.apply(this,arguments)}g.XMA_DATA_ERRORS=k;g.fetchXMAData=a;g.makeXMAFileArgs=e}),226);
__d("MAWGetProtocolMsgIdByMsgIdInUI",["MAWBridgeSendAndReceive","cr:11152","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return b("cr:11152")!=null&&c("gkx")("8564")?b("cr:11152").MAWGetProtocolMsgIdByMsgIdInUIIDB(a):h(a)};var h=function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:a})};g.getProtocolMsgIdByMsgIdUI=a}),98);
__d("MAWMessageSendReporterSideEffects",["I64","LSDatabaseSingleton","MAWBridgeOccamadilloCreateE2EEMetadataThreadHandler","MAWFolderTypes","MAWFolderUtils","ReQL","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!c("gkx")("8630"))return;var e=(yield (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton);return e.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c,e=(yield (c=d("ReQL")).firstExnAsync(c.fromTableAscending(b.messages.index("optimistic")).getKeyRange(a.externalId)));c=(yield c.firstExnAsync(c.fromTableAscending(b.threads).getKeyRange(e.threadKey)));var f=c.clientThreadKey,g=c.consistentThreadFbid;c=c.folderName;yield d("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandler").call(b,{bumpTimestampMs:e.timestampMs,creationSource:"outgoing_message_from_current_tab",folderId:(b=d("MAWFolderUtils").folderTagToFolderId(c))!=null?b:d("MAWFolderTypes").FOLDER_ID.OTHER,jid:a.chatJid,threadKeys:{authoritative:g==null?null:(i||(i=d("I64"))).to_string(g),optimistic:f==null?null:(i||(i=d("I64"))).to_string(f)}})});return function(a){return c.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":31")});return j.apply(this,arguments)}g.afterSendSideEffects=a}),98);
__d("MAWMessageSendReporter",["FBLogger","MAWMessageSendReporterSideEffects","MAWReportSendMessageSuccessResult","MWLogSendToSentFailedError","QPLUserFlow","QuickPerformanceLogger","WAGetSafeQPLError","asyncToGeneratorRuntime","cr:12058","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=e.qplEventType;e=e.qplInstanceKey;try{b=(yield b);if(b==null)return;if(b.success)b.value!=null?d("MAWReportSendMessageSuccessResult").reportSendMessageSuccessResultFn(b.value):c("QPLUserFlow").addPoint(g,"no-op",{instanceKey:e}),c("QPLUserFlow").endSuccess(g,{instanceKey:e}),b.value!=null&&(yield d("MAWMessageSendReporterSideEffects").afterSendSideEffects(b.value));else{var i,k=b.error.isRetriable===!0;c("MWLogSendToSentFailedError")((h||(h=c("QuickPerformanceLogger"))).getMarker(g,e),b.error.type,void 0,b.error.errorCode,b.error.applicationErrorCode);c("QPLUserFlow").endFailure(g,b.error.type,{annotations:{bool:{isRetriable:(i=b.error.isRetriable)!=null?i:!1},"int":{errorCode:(i=b.error.errorCode)!=null?i:0},string:{details:(i=b.error.details)!=null?i:""}},instanceKey:e});j(a,k,f)}}catch(b){c("MWLogSendToSentFailedError")((h||(h=c("QuickPerformanceLogger"))).getMarker(g,e),"runtime-failure",b),c("QPLUserFlow").endFailure(g,"runtime-failure",{annotations:{string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(b)}},instanceKey:e}),j(a,!1,f,b),c("FBLogger")("messenger_e2ee_web").catching(b).mustfix("MAWMessageSendReporter")}});return i.apply(this,arguments)}function j(a,e,f,g){if(a==null)return;var h=a.chatJid;a=a.externalId;c("promiseDone")(b("cr:12058").markMessageSendAsFailed(a,h,d("WAGetSafeQPLError").getSafeQPLErrorMessage(g),f,e))}g.MAWMessageSendReporter=a}),98);
__d("MAWSendFileMsgTypes",["WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a}function b(a){return d("WAStanzaUtils").toStanzaId(a)}g.toOfflineAttachmentIDFromStanzaId=a;g.toOfflineAttachmentIDFromString=b}),98);
__d("MAWSecureAttachmentGroupingUtils",["I64","LSIntEnum","MAWSendFileMsgTypes","MessagingAttachmentType","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){a=a.reduce(function(a,b){(h||(h=d("I64"))).equal(b.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))?a.mediaStagingsImage.push(b):a.mediaStagingsOther.push(b);return a},{mediaStagingsImage:[],mediaStagingsOther:[]});var b=a.mediaStagingsImage;a=a.mediaStagingsOther;return[].concat(b,a)}function b(a){var b=new Map();a=a.filter(function(a){return(h||(h=d("I64"))).equal(a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))});var e=a.length;if(e>1){var f=c("uuidv4")();a.forEach(function(a,c){b.set(d("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(a.offlineAttachmentId),{groupId:f,groupIndex:c,groupSize:e})})}return b}function e(a){var b=new Map(),d=a.length;if(d>1){var e=c("uuidv4")();a.forEach(function(a,c){b.set(a,{groupId:e,groupIndex:c,groupSize:d})})}return b}g.orderMediaStagingsForGrouping=a;g.generateMediaGroupMetadataForMediaStagings=b;g.generateMediaGroupMetadataForMessageIds=e}),98);
__d("MAWThreadId",["LSMessagingThreadTypeUtil","ReQL","asyncToGeneratorRuntime","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a){c("recoverableViolation")("Checking if a threadKey is a secure thread key in Occamadillo. We should be\n      checking the thread's thread type instead","maw_message_core");return!1}function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)));if(a==null)return;return a.threadType});return i.apply(this,arguments)}function e(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield h(a,b));return a==null?!1:d("LSMessagingThreadTypeUtil").isArmadilloSecure(a)});return j.apply(this,arguments)}function f(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b))}g.isThreadId=a;g.isSecureThreadId=e;g.getThreadFromJid=f}),98);
__d("MAWForwardMessage",["MAWBridgeSendAndReceive","MAWCreateOneToOneThread","MAWExternalId","MAWGetEphemeralSettings","MAWGetProtocolMsgIdByMsgIdInUI","MAWMessageSendReporter","MAWMiActOnActThreadReady","MAWSecureAttachmentGroupingUtils","MAWThreadId","Promise","asyncToGeneratorRuntime","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=(yield d("MAWThreadId").isSecureThreadId(a.tables,b));if(!f){f=(yield d("MAWCreateOneToOneThread").call(a,b,void 0,"MAWForwardMessage",e));e=f.jid;return c(e,!0)}return d("MAWMiActOnActThreadReady").onActThreadReady(a.tables,b,"MAWForwardMessage",function(a,b){return c(b,!1)})});return j.apply(this,arguments)}function a(a,b,c,d,e){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e){yield m(a,b,c,d,e)});return k.apply(this,arguments)}function e(a,b,c,d,e){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g){var i=d("MAWSecureAttachmentGroupingUtils").generateMediaGroupMetadataForMessageIds(e);yield (h||(h=b("Promise"))).allSettled([e.map(function(b){return m(a,c,b,f,g,i.get(b))})])});return l.apply(this,arguments)}function m(a,b,e,f,g,h){var j=d("MAWExternalId").generateExternalId();return i(a,b,function(i,k){return d("MAWGetProtocolMsgIdByMsgIdInUI").getProtocolMsgIdByMsgIdUI(e).then(function(e){if(e!=null)return d("MAWGetEphemeralSettings").getEphemeralSetting(i,b).then(function(b){c("promiseDone")(d("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:i,externalId:j},d("MAWBridgeSendAndReceive").sendAndReceive("backend","forwardMsg",{args:{args:{mediaGroupMetadata:h,source:f},chatJid:i,ephemeralSetting:(b=b)!=null?b:void 0,externalId:j,isFirstMsg:k,protocolMsgId:e},qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:g}),{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:g},a))})})},g)}g.maybeCreateNewThreadAndCallback=i;g.forwardMessage=a;g.forwardMessageBatch=e}),98);
__d("MAWMediaPreProcessQpl",["MAWSendQplToServer","Random","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof self.BigInt==="function",i=c("justknobx")._("3427")*1e3;function a(a,b){var e=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);a=d("MAWSendQplToServer").startQplUserFlow(c("qpl")._(1056840460,"718"),{bool:{has_big_int_support:h},string:{preprocess_type:a}},e,i);b&&a.addAnnotations({"int":{input_file_size:b.size},string:{mimetype:b.type}});return a}g.startMediaPreProcessQpl=a}),98);
__d("WABlobToImage",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a){var c;return new(g||(g=b("Promise")))(function(b,d){c=new Image();var e=URL.createObjectURL(a),f=function(){return URL.revokeObjectURL(e)};c.onload=function(){b({image:c,releaseImageMemory:f})};c.onerror=function(){f(),d("loadBlobToImage error")};c.src=e})}f.blobToImage=a}),66);
__d("WADecodeImage",["WABlobToImage","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["start decoding image with DOM: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["start decoding image without DOM: ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["decodeImage"]);e=typeof self.createImageBitmap==="function"&&typeof self.OffscreenCanvas==="function";f=e?a:c;function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){j.DEV(i(),a.name);a=(yield self.createImageBitmap(a));var b=a.width,c=a.height,d=new self.OffscreenCanvas(b,c);d=m({canvas:d,width:b,height:c,image:a});return d});return k.apply(this,arguments)}function c(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){j.DEV(h(),a.name);a=(yield d("WABlobToImage").blobToImage(a));var b=a.image;a=a.releaseImageMemory;var c=document.createElement("canvas");c=m({canvas:c,width:b.naturalWidth,height:b.naturalHeight,image:b});a();return c});return l.apply(this,arguments)}function m(a){var b=a.canvas,c=a.image,d=a.width;a=a.height;b.width=d;b.height=a;var e=b.getContext("2d");e.fillStyle="rgb(255,255,255)";e.fillRect(0,0,b.width,b.height);e.drawImage(c,0,0);b=e.getImageData(0,0,d,a);return b}g.canDecodeWithoutDOM=e;g.decodeImage=f;g.decodeImageWithoutDOM=a;g.decodeImageWithDOM=c}),98);
__d("MAWImagePreProcess",["MAWGetImageSpec","MAWImageUtils","MAWMediaPreProcessQpl","Promise","WABlobToArrayBuffer","WACustomError","WADecodeImage","WAMediaWasmWorkerClient","WAPromiseTimeout","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","cometIsMimeTypeForMedia","err","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished jpeg transcoding through mozjpeg: "," bytes"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["start process image through wasm, file name: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while transcoding image through browser api: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["start image transcode ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while processing url to thumbnail in worker: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished image transcoding through browser api: "," bytes"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["start image transcoding through browser api"]);o=function(){return a};return a}var p=12e4,q=d("WATagsLogger").TAGS(["ImagePreProcess"]),r=85,s=["image/heic"];function e(a,e,f){var g;e?g=a.type==="image/webp"?(h||(h=b("Promise"))).resolve(a):v(a,"image/webp",e,f):g=a.type==="image/gif"?(h||(h=b("Promise"))).resolve(a):v(a,"image/jpeg",!1,f);f=a.type==="image/gif"&&c("gkx")("8554");return f?g.then(function(a){return(h||(h=b("Promise"))).all([d("MAWGetImageSpec").getImageSpec(a),a])}).then(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=b[0];b=b[1];return{file:b,imageSpec:f,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(b):null,thumbnailUrlAndSpec:null,type:u(a,e)}});return function(a){return f.apply(this,arguments)}}()):g.then(function(e){return(h||(h=b("Promise"))).all([B(a,c("justknobx")._("2033")),d("MAWGetImageSpec").getImageSpec(e),e])}).then(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(f){var g=f[0],i=f[1];f=f[2];return(h||(h=b("Promise"))).resolve({file:f,imageSpec:i,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(f):null,thumbnailUrlAndSpec:g,type:u(a,e)})});return function(a){return f.apply(this,arguments)}}())}function f(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var f=a.URL.createObjectURL(b),g=e===!0?c("justknobx")._("2545"):c("justknobx")._("2033"),h=u(b,e),i,j;h=h==="animated_image"&&c("gkx")("8554");h||(i=(yield d("MAWImageUtils").urlToThumbnailSpec(f,g)),j={height:i.height,width:i.width});return{file:b,imageSpec:j,thumbnailSpec:i,type:u(b,e),url:f}});return t.apply(this,arguments)}function u(a,b){return b===!0?"sticker":a.type==="image/gif"?"animated_image":"image"}function v(a,b,c,d){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){q.DEV(l(),a.name);var i=d("MAWMediaPreProcessQpl").startMediaPreProcessQpl("image",a);i.addAnnotations({"int":{total_number_of_files:(g=g)!=null?g:1},string:{targetMimetype:e}});var j=function(){return y(a,e,r,f).then(function(a){return a.success?a.value:(h||(h=b("Promise"))).reject("runtime-error")})["catch"](function(a){q.ERROR(k(),a);i.addPoint("native_encode_failure",{string:{native_encode_error:a.toString()}});return null})};g=e==="image/jpeg"?yield d("WAPromiseTimeout").promiseTimeout(z(a,r,i).then(function(a){return a.success?a.value:(h||(h=b("Promise"))).reject(a.error)}),p)["catch"](function(a){a instanceof d("WACustomError").TimeoutError?i.addPoint("mozjpeg_encode_timeout"):i.addPoint("mozjpeg_encode_failure",{string:{mozjpeg_encode_error:a.toString()}});return j()}):yield j();if(g==null){i.endFail("unable_to_transcode_image");throw c("err")("unable to transcode image")}i.endSuccess({"int":{compressed_file_size:g.size}});return g});return w.apply(this,arguments)}function x(b,c){b=a.URL.createObjectURL(b);return d("MAWImageUtils").urlToThumbnail(b,c)}function y(b,c,e,f){q.DEV(o());var g=a.URL.createObjectURL(b),h=b.name;return d("MAWImageUtils").urlToFile(g,c,e,f).then(function(a){a=a.blob;q.DEV(n(),a.size);return d("WAResultOrError").makeResult(new File([a],h,{type:c}))})}function z(a,b,c){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){q.LOG(j(),a.name);var f=c("gkx")("4944");d("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("progressiveJpegEncode");e.addPoint("prewarm_worker_started");var g;d("WADecodeImage").canDecodeWithoutDOM&&(g=(yield d("WAMediaWasmWorkerClient").progressiveJpegEncodeInWorkerWithFile({eventFlow:e,file:a,quality:b,useHdScanConfig:!0})));if(g==null||!g.success&&g.error==="decode-image-error"&&f){f=(yield d("WADecodeImage").decodeImageWithDOM(a)["catch"](function(a){e.addPoint("image_decode_failure");throw a}));e.addPoint("image_decode_success");g=(yield d("WAMediaWasmWorkerClient").progressiveJpegEncodeInWorker({eventFlow:e,imageData:f,quality:b,useHdScanConfig:!0}))}if(!g.success)return g;e.addPoint("pjpeg_encode_success");q.LOG(i(),g.value.byteLength);return d("WAResultOrError").makeResult(new File([g.value],a.name,{type:"image/jpeg"}))});return A.apply(this,arguments)}function B(e,f){var g=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=a.URL.createObjectURL(e),c=(yield d("MAWImageUtils").urlToThumbnail(b,f));a.URL.revokeObjectURL(b);return c});return function(){return c.apply(this,arguments)}}();if(!d("WADecodeImage").canDecodeWithoutDOM)return g();var h=c("justknobx")._("2338")*1024,i=c("justknobx")._("2340");return d("WAPromiseTimeout").promiseTimeout(d("WAMediaWasmWorkerClient").generateImageThumbnailInWorker({file:e,maxDimension:f,thumbnailBlobByteSizeLimitBytes:h,thumbnailQualityPercentageWhenAboveByteSizeLimit:i}).then(function(a){if(!a.success)throw c("err")("urlToFileInWorker error: "+a.error);return{height:a.value.height,jpegThumbnail:a.value.blob,width:a.value.width}})["catch"](function(a){q.ERROR(m(),a);throw a}),p)["catch"](function(a){return g()})}function C(a){if(a==="image/gif"||a==="image/webp")return!0;return!d("cometIsMimeTypeForMedia").isMimeTypeForPhoto(a)?!1:!s.includes(a)}g.imagePreprocess=e;g.optimisticImagePreprocess=f;g.getJpegThumbnailInfo=x;g.generateImageThumbnailInWorkerWithFallback=B;g.isSupportedImageFileType=C}),98);
__d("VideoFrameBuffer",["HTMLMediaElementReadyStates"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b,c,d,e,f,g){d===void 0&&(d=null),e===void 0&&(e=null),f===void 0&&(f=null),g===void 0&&(g=null),this.$2=b,this.$1=a,this.$3=c||"contain",this.$6=d,this.$7=e,this.$8=f,this.$9=g}var b=a.prototype;b.updateFrameBuffer=function(){this.$4&&(this.$1.width=this.$4,this.$4=null);this.$5&&(this.$1.height=this.$5,this.$5=null);if(this.$2.readyState<c("HTMLMediaElementReadyStates").HAVE_CURRENT_DATA)return;var a=this.$1.clientWidth||this.$1.width,b=this.$1.clientHeight||this.$1.height,d=a,e=b,f=this.$2.videoWidth/this.$2.videoHeight,g=d/e;this.$3==="cover"&&(g*=-1,f*=-1);g>f?d=e*f:g<f&&(e=d/f);g=this.$1.getContext("2d");if(!(g instanceof window.CanvasRenderingContext2D))return;try{if(this.$6||this.$7){g.drawImage(this.$2,(f=this.$8)!=null?f:0,(f=this.$9)!=null?f:0,(f=this.$6)!=null?f:a,(f=this.$7)!=null?f:b,0,0,a,b)}else g.drawImage(this.$2,(a-d)/2,(b-e)/2,d,e)}catch(a){if(a.name!=="NS_ERROR_NOT_AVAILABLE")throw a}};b.getDOMNode=function(){return this.$1};b.updateDimensions=function(a,b){this.$4=a,this.$5=b};return a}();g["default"]=a}),98);
__d("generateVideoThumbnails",["CPXComposerConstants","CanvasVideoThumbnail","HTMLMediaElementReadyStates","Promise","VideoFrameBuffer","cr:909281","gkx"],(function(a,b,c,d,e,f,g){var h,i=.5625;function a(a,d,e,f,g,i,o,p,q,r){g===void 0&&(g="contain");i===void 0&&(i=0);o===void 0&&(o=null);p===void 0&&(p=null);q===void 0&&(q=null);r===void 0&&(r=null);return new(h||(h=b("Promise")))(function(h,s){var t=document.createElement("canvas"),u=[],v=0,w=a.duration-i;r!=null&&(w=Math.min(w,r));var x=w/f,y=null,z=null,A,B=(w=p)!=null?w:j(o,d),C=(w=q)!=null?w:k(o,e),D=l(o,d),E=m(o,e);t.width=(w=B)!=null?w:d;t.height=(w=C)!=null?w:e;var F=new(c("VideoFrameBuffer"))(t,a,g,B,C,D,E);F.updateFrameBuffer();var G=function(){F.updateFrameBuffer();var b=new(c("CanvasVideoThumbnail"))(t,a,i+(v-1)*x,B,C,D,E);u.push(b);(!y||b.getURL().length>y.getURL().length)&&(y=b,z=n(o,a));I()},H=function(){if(a.readyState>=c("HTMLMediaElementReadyStates").HAVE_CURRENT_DATA)G();else if(b("cr:909281")!==null)var d=b("cr:909281").listen(a,"loadeddata",function(){d.remove(),G()});else a.addEventListener("loadeddata",G,{once:!0})},I=function(){v===0&&(b("cr:909281")!==null?A=b("cr:909281").listen(a,"seeked",H):a.addEventListener("seeked",H)),v<f?(a.currentTime=i+v*x,v++):(b("cr:909281")!==null?A&&A.remove():a.removeEventListener("seeked",H),h({thumbnails:u,selectedThumbnail:y,croppedThumbnailUri:z}))};if(a.videoWidth===0||a.videoHeight===0){s();return}I()})}function j(a,b){if(a&&a.spherical){if(a.stereoMode==="left-right")return b/2;if(a.projectionType==="cubemap")return b/3}return null}function k(a,b){return a&&a.spherical&&(a.stereoMode==="top-bottom"||a.projectionType==="cubemap")?b/2:null}function l(a,b){return a&&a.spherical&&a.projectionType==="cubemap"?b/3:0}function m(a,b){return a&&a.spherical&&a.projectionType==="cubemap"?b/2:0}function n(a,b){var e=b.videoWidth!=null&&b.videoHeight!=null?b.videoWidth/b.videoHeight:i,f=e<1;if(a==null&&!f&&c("gkx")("4735")){a=document.createElement("canvas");f=a.getContext("2d");var g=b.videoWidth,h=b.videoHeight;a.width=g;a.height=h;f.drawImage(b,0,0,g,h);f=document.createElement("canvas");e>=1&&e<1.2?(b=g*(d("CPXComposerConstants").REEL_THUMBNAIL_WIDTH/d("CPXComposerConstants").REEL_THUMBNAIL_HEIGHT),e=h):(b=h,e=g);f.width=b;f.height=e;var j=f.getContext("2d");j.drawImage(a,0,0,g,h,0,0,b,e);return f.toDataURL("image/jpeg")}return null}g["default"]=a}),98);
__d("MAWVideoUtils",["MAWImageUtils","Promise","err","generateVideoThumbnails"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var e=document.body;if(!e)return new(h||(h=b("Promise")))(function(a,b){return b("Unable to find DOM body, please use this util only in DOM environment.")});var f=document.createElement("video");return new(h||(h=b("Promise")))(function(d,g){f.setAttribute("style","display: none"),f.setAttribute("src",URL.createObjectURL(a)),f.addEventListener("loadedmetadata",function(a){a=a.currentTarget;if(a instanceof HTMLVideoElement){var e=a.duration,i=a.videoHeight;a=a.videoWidth;var j=c("generateVideoThumbnails")(f,a,i,1);d((h||(h=b("Promise"))).all([j,a,i,Math.ceil(e)]))}else g("EventTarget returned for event should be HTMLVideoElement")}),f.addEventListener("error",function(a){g("Unable to load video")}),e.appendChild(f)}).then(function(a){var b=a[0],c=a[1],g=a[2],h=a[3];e.removeChild(f);return d("MAWImageUtils").canvasToBlob(b.thumbnails[0].getCanvas(),d("MAWImageUtils").TYPE_JPEG,!0).then(function(a){return a.arrayBuffer().then(function(a){return{duration:h,height:g,jpegThumbnail:a,width:c}})})})["catch"](function(a){e.removeChild(f);throw c("err")(a)})}function e(a){var d=document.body;if(!d)return new(h||(h=b("Promise")))(function(a,b){return b("Unable to find DOM body, please use this util only in DOM environment.")});var e=document.createElement("video");return new(h||(h=b("Promise")))(function(b,c){e.setAttribute("style","display: none"),e.setAttribute("src",URL.createObjectURL(a)),e.addEventListener("loadedmetadata",function(a){a=a.currentTarget;if(a instanceof HTMLVideoElement){var d=a.duration,e=a.videoHeight;a=a.videoWidth;b({duration:Math.ceil(d),height:e,width:a})}else c("EventTarget returned for event should be HTMLVideoElement")}),e.addEventListener("error",function(a){c("Unable to load video")}),d.appendChild(e)})["catch"](function(a){d.removeChild(e);throw c("err")(a)})}g.getVideoThumbnailUrlAndSpec=a;g.getVideoThumbnailSpec=e}),98);
__d("MAWFowardMessageFromOpenThread",["I64","LSIntEnum","MAWBridgeSendAndReceive","MAWDocumentPreProcess","MAWFetchXMABlob","MAWFetchXMAData","MAWForwardMessage","MAWGetEphemeralSettings","MAWGetImageSpec","MAWImagePreProcess","MAWMessageSendReporter","MAWUnshimUrl","MAWVideoUtils","MessagingAttachmentType","Promise","ReQL","WAArmadilloXMA.pb","WABlobToArrayBuffer","asyncToGeneratorRuntime","gkx","qpl","sendToSentQPLLogger","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k="369239263222822",l="369239343222814",m="369239383222810";function n(a){return a===k||a===l||a===m}function o(a,e){return(j||(j=b("Promise"))).all([d("MAWGetImageSpec").getImageSpec_DEPRECATED(a),j.resolve(a),e.arrayBuffer(),d("MAWGetImageSpec").getImageSpec_DEPRECATED(e)]).then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0],e=a[1],f=a[2];a=a[3];return{file:e,imageSpec:b,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(e):null,thumbnailUrlAndSpec:{duration:void 0,height:a.height,jpegThumbnail:f,width:a.width},type:"image"}});return function(b){return a.apply(this,arguments)}}())}function p(a){return d("MAWVideoUtils").getVideoThumbnailUrlAndSpec(a).then(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){return{file:a,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(a):null,thumbnailUrlAndSpec:b,type:"video"}});return function(a){return e.apply(this,arguments)}}())}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"MAWFowardMessageFromOpenThread",url:a}));b=a==null?void 0:new File([a],b,{type:a.type});a=b!=null?yield d("MAWGetImageSpec").getImageSpec_DEPRECATED(b):null;return b!=null&&a!=null?{file:b,height:a.height,width:a.width}:void 0});return r.apply(this,arguments)}function s(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.tables.attachment_ctas).getKeyRange(a)));return c==null||b==null&&c.actionUrl==null?null:{actionUrl:(a=c==null?void 0:c.actionUrl)!=null?a:void 0,buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:(a=c==null?void 0:c.actionUrl)!=null?a:void 0,title:(c=b)!=null?c:void 0}});return t.apply(this,arguments)}function u(a,b,c,d){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=(yield w(b,e));if((g==null?void 0:g.actionUrl)==null){c("gkx")("8783")||d("sendToSentQPLLogger").markSendToSentFail(f,"null_xma_url");throw c("unrecoverableViolation")("Cannot forward XMA to secure threads without a defaultCTA and actionUrl","messenger_web_sharing")}a=(yield d("MAWFetchXMAData").fetchXMAData(a,g.actionUrl,[f]));if(a.linkType==="unknown"){c("gkx")("8783")||d("sendToSentQPLLogger").markSendToSentFail(f,"unknown_xma_link_type");throw c("unrecoverableViolation")("Cannot forward XMA to secure threads with an unknown link type","messenger_web_sharing")}if(a.linkType==="external")return A(b,g,e,a);else return y(a,f)});return v.apply(this,arguments)}function w(a,b){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.actionUrl,e=a.defaultCtaId;a=a.defaultCtaTitle;if(e==null)return null;e=(yield s(e,a,b));return(b=e)!=null?b:{actionUrl:(e=c)!=null?e:void 0,buttonType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:(b=c)!=null?b:void 0,title:(e=a)!=null?e:void 0}});return x.apply(this,arguments)}function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("MAWFetchXMAData").makeXMAFileArgs(a,b));var c=a.ctas,e=a.defaultCTA,f=a.overlayIconGlyph,g=a.subtitle_text,h=a.title_text;a=a.xma_message_type;c={ctas:c,defaultCTA:e,overlayIconGlyph:f,subtitleText:g,titleText:h};return babelHelpers["extends"]({},b,{xmaArgs:c,xmaMessageType:(e=a)!=null?e:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE})});return z.apply(this,arguments)}function A(a,b,c,d){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=a.attachmentCta1Id,i=a.attachmentCta2Id,k=a.attachmentCta3Id,l=a.cta1Title,m=a.cta2Title,n=a.cta3Title,o=a.faviconUrl,p=a.headerImageUrl,r=a.headerTitle,t=a.maxSubtitleNumOfLines,u=a.maxTitleNumOfLines,v=a.previewUrl,w=a.subtitleText;a=a.titleText;o=(yield (j||(j=b("Promise"))).all([[o,"favicon"],[p,"headerImage"],[v,"preview"]].map(function(a){return q(a[0],a[1])})));p=o[0];v=o[1];o=o[2];var x=[];if(g!=null){g=(yield s(g,l,e));g!=null&&x.push(g)}if(i!=null){l=(yield s(i,m,e));l!=null&&x.push(l)}if(k!=null){g=(yield s(k,n,e));g!=null&&x.push(g)}l={ctas:x.map(function(a){return babelHelpers["extends"]({},a,{actionUrl:d("MAWUnshimUrl").unshimUrl(a.actionUrl),nativeUrl:d("MAWUnshimUrl").unshimUrl(a.nativeUrl)})}),defaultCTA:babelHelpers["extends"]({},c,{actionUrl:d("MAWUnshimUrl").unshimUrl(c.actionUrl),nativeUrl:d("MAWUnshimUrl").unshimUrl(c.nativeUrl)}),headerTitle:r,maxSubtitleNumOfLines:(h||(h=d("I64"))).to_int32((i=t)!=null?i:(h||(h=d("I64"))).zero),maxTitleNumOfLines:h.to_int32((m=u)!=null?m:(h||(h=d("I64"))).zero),overlayIconGlyph:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE,subtitleText:w,titleText:a};return{faviconFileArgs:p,headerFileArgs:v,previewFileArgs:o,xmaArgs:l,xmaMessageType:f.xma_message_type}});return B.apply(this,arguments)}function C(a){var e=a.attachmentType,f=a.filename,g=a.playableDurationMs,k=a.playableUrl,l=a.playableUrlMimeType,m=a.previewUrl,n=a.previewUrlMimeType;if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))||(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))||(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE))||(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE))){if(k==null)throw c("unrecoverableViolation")("If you see this error, there is no playableUrl for this attachment","messenger_web_sharing");var q=(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE));if(m!=null){a=q?m+"&":k;var r=q?m+"&":m;return(j||(j=b("Promise"))).all([window.fetch(a).then(function(a){return a.blob()}),window.fetch(r).then(function(a){return a.blob()})]).then(function(a){var b=a[0];a=a[1];b=new File([b],"mediaForwardedFromOpenThread",{type:q?n:l});a=new File([a],"previewForwardedFromOpenThread",{type:n});if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE)))return o(b,a);if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO)))return p(b);if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE)))return o(b,a);throw c("unrecoverableViolation")("shouldn't have this error in forward message from open thread","messenger_web_sharing")})}a=q?k+"&":k;return window.fetch(a).then(function(a){return a.blob()}).then(function(a){if(q&&l==="video/mp4")throw c("unrecoverableViolation")("If you see this error, there is only mp4 url for gif","messenger_web_sharing");a=new File([a],(a=f)!=null?a:"mediaForwardedFromOpenThread",{type:l});if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE)))return d("MAWImagePreProcess").imagePreprocess(a,!1);if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO)))return p(a);if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE)))return d("MAWDocumentPreProcess").documentPreprocess(a);if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE)))return(j||(j=b("Promise"))).all([d("MAWImagePreProcess").getJpegThumbnailInfo(a,400),d("MAWGetImageSpec").getImageSpec_DEPRECATED(a),j.resolve(a)]).then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0],e=a[1];a=a[2];return{file:a,imageSpec:e,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(a):null,thumbnailUrlAndSpec:b,type:"image"}});return function(b){return a.apply(this,arguments)}}());throw c("unrecoverableViolation")("shouldn't have this error in forward message from open thread","messenger_web_sharing")})}if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO))){if(k!=null)return window.fetch(k+"&").then(function(a){return a.blob()}).then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=new File([a],"mediaForwardedFromOpenThread",{type:l});return{durations:(h||(h=d("I64"))).to_int32((b=g)!=null?b:(h||(h=d("I64"))).zero)/1e3,file:a,isPtt:!0,plaintext:c("gkx")("1540")?yield d("WABlobToArrayBuffer").blobToArrayBuffer(a):null,type:"audio"}});return function(b){return a.apply(this,arguments)}}());throw c("unrecoverableViolation")("If you see this error, there is no playableUrl for this audio attachment","messenger_web_sharing")}if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER))){if(k==null&&m==null)throw c("unrecoverableViolation")("If you see this error, there is no url for this sticker","messenger_web_sharing");return k!=null?m!=null?(j||(j=b("Promise"))).all([window.fetch(k).then(function(a){return a.blob()}),window.fetch(m).then(function(a){return a.blob()})]).then(function(a){var b=a[0];a=a[1];b=new File([b],"mediaForwardedFromOpenThread",{type:l});a=new File([a],"previewForwardedFromOpenThread",{type:n});return o(b,a)}):window.fetch(k).then(function(a){return a.blob()}).then(function(a){a=new File([a],"mediaForwardedFromOpenThread",{type:l});return o(a,a)}):window.fetch(m).then(function(a){return a.blob()}).then(function(a){return d("MAWImagePreProcess").imagePreprocess(new File([a],"previewForwardedFromOpenThread",{type:n}),!0)})}throw c("unrecoverableViolation")("We do not support forwarding other media types. Received attachment "+(i||(i=d("LSIntEnum"))).toNumber(e),"messenger_web_sharing")}function a(a,e,f,g,k,l,m,o,p){return new(j||(j=b("Promise")))(function(j,q){return d("MAWForwardMessage").maybeCreateNewThreadAndCallback(e,f,function(q,r){var s=d("MAWGetEphemeralSettings").getEphemeralSetting(q,f),t=r;return s.then(function(f){if(l!=null){if(n(l.attachmentFbid)){var r;r=d("MAWBridgeSendAndReceive").sendAndReceive("backend","sendMsg",{args:{content:"\ud83d\udc4d",ephemeralSetting:(r=f)!=null?r:void 0,isFirstMsg:t,isForwarded:k,source:m,specialTextSize:1},chatJid:q,externalId:p,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o});return j(c("gkx")("8783")?r:d("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:q,externalId:p},r,{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o},e))}return(h||(h=d("I64"))).equal(l.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA))?u(a,l,e,o).then(function(a){var b,h=a.faviconFileArgs,i=a.headerFileArgs,k=a.previewFileArgs,l=a.xmaArgs;a=a.xmaMessageType;a=d("MAWBridgeSendAndReceive").sendAndReceive("backend","sendXMAShareMsg",{args:{content:c("gkx")("3194")?g.text:void 0,ephemeralSetting:(b=f)!=null?b:void 0,isFirstMsg:t,isForwarded:!0,xmaMessageType:(b=a)!=null?b:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE},chatJid:q,faviconFile:h,headerFile:i,previewFile:k,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o,xmaArgs:l,xmaMsgExternalId:p});return j(c("gkx")("8783")?a:d("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:q,externalId:p},a,{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o},e))}):C(l).then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;switch(a.type){case"image":var g,h=a.imageSpec,i=a.thumbnailUrlAndSpec;b={args:{ephemeralSetting:(g=f)!=null?g:void 0,height:h.height,isFirstMsg:t,isForwarded:k,jpegThumbnail:i==null?void 0:i.jpegThumbnail,jpegThumbnailHeight:i==null?void 0:i.height,jpegThumbnailWidth:i==null?void 0:i.width,source:m,width:h.width},attachmentType:"image",chatJid:q,externalId:p};break;case"video":g=a.thumbnailUrlAndSpec;b={args:{duration:g.duration,ephemeralSetting:(i=f)!=null?i:void 0,height:g.height,isFirstMsg:t,isForwarded:k,jpegThumbnail:g.jpegThumbnail,jpegThumbnailHeight:g.height,jpegThumbnailWidth:g.width,source:m,width:g.width},attachmentType:"video",chatJid:q,externalId:p};break;case"audio":h=a.durations;i=a.isPtt;b={args:{duration:Math.round(h),ephemeralSetting:(g=f)!=null?g:void 0,isFirstMsg:t,isForwarded:k,isPtt:i,source:m},attachmentType:"audio",chatJid:q,externalId:p};break;case"document":b={args:{ephemeralSetting:(h=f)!=null?h:void 0,filename:a.filename,isFirstMsg:t,isForwarded:k,source:m},attachmentType:"application",chatJid:q,externalId:p};break}if(b==null)throw c("unrecoverableViolation")("We do not support forwarding this attachment type: "+a.type,"messenger_web_sharing");i=c("gkx")("1540")?d("MAWBridgeSendAndReceive").sendAndReceive("backend","sendMediaMsgV2",babelHelpers["extends"]({},b,{mimeType:a.file.type,plaintext:(g=a.plaintext)!=null?g:yield d("WABlobToArrayBuffer").blobToArrayBuffer(a.file),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o})):d("MAWBridgeSendAndReceive").sendAndReceive("backend","sendMediaMsg",babelHelpers["extends"]({},b,{file:a.file,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o}));return j(c("gkx")("8783")?i:d("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:q,externalId:p},i,{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o},e))});return function(b){return a.apply(this,arguments)}}())}r=g.text;if(r!=null){r=d("MAWBridgeSendAndReceive").sendAndReceive("backend","sendMsg",{args:{content:g.text,ephemeralSetting:(r=f)!=null?r:void 0,isFirstMsg:t,isForwarded:k,source:m},chatJid:q,externalId:p,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o});return j(c("gkx")("8783")?r:d("MAWMessageSendReporter").MAWMessageSendReporter({chatJid:q,externalId:p},r,{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:o},e))}throw c("unrecoverableViolation")("We do not support forwarding this types","messenger_web_sharing")})},o)["catch"](function(a){q(a)})})}g.downloadMediaByUrl=C;g.forwardMessage=a}),98);
__d("LSLocalApplyOptimisticMessageWithAttachments",["LSArrayGetObjectAt","LSLocalApplyOptimisticMessage","LSSetMessageDisplayedContentTypes","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(c){return d.storedProcedure(b("LSLocalApplyOptimisticMessage"),a[0],a[1],a[2],a[3],a[4],a[5],a[6],void 0,a[7],a[8],a[9],a[10],void 0,a[12],!0).then(function(a){return a=a,e[0]=a[0],e[1]=a[1],a})},function(f){return e[2]=d.i64.of_int32(a[11].length),d.i64.gt(e[2],d.i64.cast([0,0]))?d.loopAsync(e[2],function(f){return e[3]=f,d.sequence([function(c){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[11],e[3]).then(function(a){return a=a,e[4]=a[0],e[5]=a[1],a})},function(b){return e[6]=e[4].get("attachment_fbid"),e[4],e[7]=e[4].get("offline_attachment_id"),e[4],e[8]=e[4].get("attachment_type"),e[4],e[9]=e[4].get("filename"),e[4],e[10]=e[4].get("filesize"),e[4],e[11]=e[4].get("attachment_index"),e[4],e[12]=e[4].get("has_media"),e[4],e[13]=e[4].get("has_xma"),e[4],e[14]=e[4].get("playable_url"),e[4],e[15]=e[4].get("playable_url_mime_type"),e[4],e[16]=e[4].get("playable_duration_ms"),e[4],e[17]=e[4].get("preview_url"),e[4],e[18]=e[4].get("preview_url_mime_type"),e[4],e[19]=e[4].get("mini_preview"),e[4],e[20]=e[4].get("preview_width"),e[4],e[21]=e[4].get("preview_height"),e[4],e[22]=e[4].get("xma_layout_type"),e[4],e[23]=e[4].get("xmas_template_type"),e[4],e[24]=e[4].get("cta1_title"),e[4],e[25]=e[4].get("cta2_title"),e[4],e[26]=e[4].get("cta3_title"),e[4],e[27]=e[4].get("image_url"),e[4],e[28]=e[4].get("action_url"),e[4],e[29]=e[4].get("title_text"),e[4],e[30]=e[4].get("subtitle_text"),e[4],e[31]=e[4].get("description_text"),e[4],e[32]=e[4].get("source_text"),e[4],e[33]=e[4].get("original_file_hash"),e[4],e[34]=e[4].get("sound_bite_client_sound_key"),e[4],e[35]=e[4].get("sound_bite_visual"),e[4],e[36]=e[4].get("ephemeral_media_state"),e[4],e[37]=e[4].get("waveform_data"),e[4],e[38]=e[4].get("sampling_frequency_hz"),e[4],c("gkx")("4303")?(e[17]!==void 0?e[40]=e[17]:e[40]=e[14],e[39]=e[40]):e[39]=e[17],d.filter(d.db.table(16).fetch([[[a[1],e[0],e[6]]]]),function(b){return d.i64.eq(b.threadKey,a[1])&&d.i64.eq(d.i64.cast([0,0]),d.i64.cast([0,0]))&&b.messageId===e[0]&&b.attachmentFbid===e[6]&&d.i64.gt(b.authorityLevel,d.i64.cast([0,20]))}).next().then(function(b){var c=b.done;b.value;return c?d.db.table(16).put({threadKey:a[1],messageId:e[0],attachmentFbid:e[6],timestampMs:e[1],offlineAttachmentId:e[7],attachmentType:e[8],filename:e[9],filesize:e[10],attachmentIndex:e[11],hasMedia:e[12],hasXma:e[13],isSharable:!1,playableUrl:e[14],playableUrlMimeType:e[15],playableDurationMs:e[16],previewUrl:e[39],previewUrlMimeType:e[18],miniPreview:e[19],previewWidth:e[20],previewHeight:e[21],xmaLayoutType:e[22],xmasTemplateType:e[23],cta1Title:e[24],cta2Title:e[25],cta3Title:e[26],imageUrl:e[27],actionUrl:e[28],titleText:e[29],subtitleText:e[30],descriptionText:e[31],sourceText:e[32],ephemeralMediaState:e[36],originalFileHash:e[33],authorityLevel:d.i64.cast([0,20]),samplingFrequencyHz:e[38],waveformData:e[37]}):0})}])}):d.resolve()},function(c){return e[2]=d.i64.of_int32(a[11].length),d.i64.gt(e[2],d.i64.cast([0,0]))?d.storedProcedure(b("LSSetMessageDisplayedContentTypes"),a[1],e[0],e[1],a[3],!1,d.i64.neq(a[6],void 0)):d.resolve()},function(a){return a=[e[0],e[1]],f[0]=a[0],f[1]=a[1],a}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSMailboxLocalApplyOptimisticMessageWithAttachmentsStoredProcedure";a.__tables__=["attachments"];d=a;g["default"]=d}),98);
__d("LSLocalApplyOptimisticMessageWithAttachmentsStoredProcedure",["LSLocalApplyOptimisticMessageWithAttachments","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e=c("LSLocalApplyOptimisticMessageWithAttachments")(e.senderId,e.threadKey,e.threadType,e.text,e.snippet,e.snippetHasEmoji,e.stickerId,e.replySourceId,e.replySourceType,e.replySourceTypeV2,e.isForwarded,e.attachments,e.mentionData,a);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e))}g["default"]=a}),98);
__d("LSOptimisticSendXMAMessageForwardFromSecureThread",["LSArrayGetObjectAt","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSSetMessageDisplayedContentTypes","LSUpdateOptimisticAttachmentPreview"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSLocalApplyOptimisticMessage"),a[0],a[1],a[2],a[3],void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,3]),a[4],void 0,void 0,!0).then(function(a){return a=a,d[0]=a[0],d[1]=a[1],a})},function(e){return d[3]=c.i64.of_int32(a[6].length),c.i64.gt(d[3],c.i64.cast([0,0]))?c.loopAsync(d[3],function(e){return d[4]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[6],d[4]).then(function(a){return a=a,d[5]=a[0],d[6]=a[1],a})},function(e){return d[7]=d[5].get("attachment_fbid"),d[5],d[8]=d[5].get("offline_attachment_id"),d[5],d[9]=d[5].get("attachment_type"),d[5],d[10]=d[5].get("filename"),d[5],d[11]=d[5].get("filesize"),d[5],d[12]=d[5].get("attachment_index"),d[5],d[13]=d[5].get("has_media"),d[5],d[14]=d[5].get("has_xma"),d[5],d[15]=d[5].get("playable_url"),d[5],d[16]=d[5].get("playable_url_mime_type"),d[5],d[17]=d[5].get("playable_duration_ms"),d[5],d[18]=d[5].get("preview_url"),d[5],d[19]=d[5].get("preview_url_mime_type"),d[5],d[20]=d[5].get("mini_preview"),d[5],d[21]=d[5].get("preview_width"),d[5],d[22]=d[5].get("preview_height"),d[5],d[23]=d[5].get("xma_layout_type"),d[5],d[24]=d[5].get("xmas_template_type"),d[5],d[25]=d[5].get("cta1_title"),d[5],d[26]=d[5].get("cta2_title"),d[5],d[27]=d[5].get("cta3_title"),d[5],d[28]=d[5].get("image_url"),d[5],d[29]=d[5].get("action_url"),d[5],d[30]=d[5].get("title_text"),d[5],d[31]=d[5].get("subtitle_text"),d[5],d[32]=d[5].get("description_text"),d[5],d[33]=d[5].get("source_text"),d[5],d[34]=d[5].get("original_file_hash"),d[5],d[35]=d[5].get("sound_bite_client_sound_key"),d[5],d[36]=d[5].get("sound_bite_visual"),d[5],d[37]=d[5].get("ephemeral_media_state"),d[5],c.sequence([function(b){return c.forEach(c.filter(c.db.table(16).fetch([[[a[1],d[0],d[7]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&b.messageId===d[0]&&b.attachmentFbid===d[7]&&c.i64.lt(b.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(b){return c.db.table(16).add({threadKey:a[1],messageId:d[0],attachmentFbid:d[7],timestampMs:d[1],offlineAttachmentId:d[8],attachmentType:d[9],filename:d[10],filesize:d[11],attachmentIndex:d[12],hasMedia:d[13],hasXma:d[14],isSharable:!1,playableUrl:d[15],playableUrlMimeType:d[16],playableDurationMs:d[17],previewUrl:d[18],previewUrlMimeType:d[19],miniPreview:d[20],previewWidth:d[21],previewHeight:d[22],xmaLayoutType:d[23],xmasTemplateType:d[24],cta1Title:d[25],cta2Title:d[26],cta3Title:d[27],imageUrl:d[28],actionUrl:d[29],titleText:d[30],subtitleText:d[31],descriptionText:d[32],sourceText:d[33],ephemeralMediaState:d[37],originalFileHash:d[34],authorityLevel:c.i64.cast([0,20])})},function(e){return c.storedProcedure(b("LSSetMessageDisplayedContentTypes"),a[1],d[0],d[1],a[3],!1,!1)},function(e){return c.storedProcedure(b("LSUpdateOptimisticAttachmentPreview"),a[1],d[0],d[7],d[15],void 0,void 0,d[16],d[18],void 0,void 0,d[19],d[21],d[22])}])}])}):c.resolve()},function(e){return c.storedProcedure(b("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),c.i64.to_string(a[1]),c.i64.cast([0,46]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,1]),void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.db.table(31).add({taskId:d[2],threadKey:a[1],offlineThreadingId:d[0],threadAttributionSource:a[5],sendType:c.i64.cast([0,11]),markThreadRead:!1})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxOptimisticSendXMAMessageForwardFromSecureThreadStoredProcedure";a.__tables__=["attachments","messages_optimistic_context"];e.exports=a}),null);
__d("LSOptimisticSendXMAMessageForwardFromSecureThreadStoredProcedure",["LSOptimisticSendXMAMessageForwardFromSecureThread","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e=c("LSOptimisticSendXMAMessageForwardFromSecureThread")(e.senderId,e.threadKey,e.threadType,e.text,e.isForwarded,e.source,e.attachments,a);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e))}g["default"]=a}),98);
__d("MAWDbXMA",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a}function b(a){return a}function c(a){return(h||(h=d("I64"))).to_float(a)}g.convertNumbersToXMAIds=a;g.convertNumberToXMAId=b;g.convertXMAId64ToXMAId=c}),98);
__d("MAWForwardMessageFromSecureThread.react",["FBLogger","I64","LSFactory","LSHotEmojiSize","LSInsertNewMediaSendStoredProcedure","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsStoredProcedure","LSMailboxType","LSMarkSubJobCompletedV2StoredProcedure","LSOptimisticSendMessageV2StoredProcedure","LSOptimisticSendXMAMessageForwardFromSecureThreadStoredProcedure","LSShape","LSVec","MAWBridgeSendAndReceive","MAWDbMedia","MAWDbXMA","MWPComposerMediaUploadUtil","MWPOpenComposerUtils","MessagePowerUp","MessagingAttachmentType","OfflineThreadingId","Promise","ReQL","WAHashUtils","asyncToGeneratorRuntime","cr:2472","gkx","promiseDone","recoverableViolation","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b,c){return{action_url:void 0,attachment_fbid:b,attachment_index:(j||(j=d("I64"))).zero,attachment_type:a.attachmentType,cta1_title:void 0,cta2_title:void 0,cta3_title:void 0,description_text:void 0,filename:a.filename,filesize:void 0,has_media:!0,has_xma:!1,image_url:void 0,mini_preview:void 0,offline_attachment_id:b,original_file_hash:void 0,playable_duration_ms:a.playableDurationMs,playable_url:URL.createObjectURL(c),playable_url_mime_type:c.type,preview_height:void 0,preview_url:void 0,preview_url_mime_type:void 0,preview_width:void 0,source_text:void 0,subtitle_text:void 0,title_text:void 0,xma_layout_type:void 0,xmas_template_type:void 0}}function l(a,b,c,e){var f;return{action_url:(f=b==null?void 0:b.actionUrl)!=null?f:b==null?void 0:b.nativeUrl,attachment_fbid:c,attachment_index:(j||(j=d("I64"))).zero,attachment_type:a.attachmentType,cta1_title:a.cta1Title,cta2_title:a.cta2Title,cta3_title:a.cta3Title,description_text:a.descriptionText,filename:a.filename,filesize:a.filesize,has_media:!1,has_xma:!0,image_url:void 0,mini_preview:void 0,offline_attachment_id:c,original_file_hash:void 0,playable_duration_ms:void 0,playable_url:e!=null?URL.createObjectURL(e):void 0,playable_url_mime_type:e==null?void 0:e.type,preview_height:void 0,preview_url:e!=null?URL.createObjectURL(e):void 0,preview_url_mime_type:e==null?void 0:e.type,preview_width:void 0,source_text:a.sourceText,subtitle_text:a.subtitleText,title_text:a.titleText,xma_layout_type:a.xmaLayoutType,xmas_template_type:a.xmasTemplateType}}function m(a,e,f,g,i,j,k,l){l=c("LSFactory")(l);return c("LSOptimisticSendXMAMessageForwardFromSecureThreadStoredProcedure")(l,{attachments:c("LSVec").ofArray([d("LSShape").ofRecord(j)]),isForwarded:i,senderId:a,source:k,text:(l=g)!=null?l:void 0,threadKey:e,threadType:f}).then(function(){return(h||(h=b("Promise"))).resolve()})}function n(a,b){return a==null||b==null?void 0:{amplitudes:b.split(",").map(parseFloat),sampling_freq:a}}function o(a,e,g,k,l,m,o,p,q){var r=c("LSFactory")(p);return c("LSLocalApplyOptimisticMessageWithAttachmentsStoredProcedure")(r,{attachments:c("LSVec").ofArray([d("LSShape").ofRecord(e)]),isForwarded:m,senderId:o,threadKey:l,threadType:k}).then(function(a){var c=a[0];a[1];return p.messages_optimistic_context.add({externalAttachmentUrl:void 0,initiatingSource:void 0,markThreadRead:!1,messageId:void 0,offlineThreadingId:c,platformRef:void 0,platformToken:void 0,replySourceId:void 0,replySourceType:void 0,sendType:void 0,skipUrlPreviewGen:void 0,taskId:(j||(j=d("I64"))).of_string(c),threadAttributionSource:q,threadKey:l}).then(function(){return(h||(h=b("Promise"))).resolve(c)})}).then(function(a){var f=e.attachment_fbid;return c("LSInsertNewMediaSendStoredProcedure")(r,{attachmentType:e.attachment_type,inMessageIndex:(j||(j=d("I64"))).zero,isSecure:!1,offlineAttachmentId:f,offlineThreadingId:a,sendByServer:!1,shouldTranscode:!1,useDoublePhase:!1}).then(function(){return(h||(h=b("Promise"))).resolve([a,f])})}).then(function(b){var h=b[0],k=b[1];b=function(b,e){if(e==null||e.length===0)return;c("promiseDone")(a.runInTransaction(function(a){var b=c("LSFactory")(a);return c("LSMarkSubJobCompletedV2StoredProcedure")(b,{fbid:(j||(j=d("I64"))).of_string(e),offlineAttachmentId:k}).then(function(){return d("MWPOpenComposerUtils").resumeSendJob(b,h)})},"readwrite",void 0,void 0,f.id+":223"))};return d("MWPComposerMediaUploadUtil").startUpload(void 0,void 0,b,void 0,(j||(j=d("I64"))).equal(e.attachment_type,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO)),[g],[k],void 0,void 0,n(e.sampling_frequency_hz,e.waveform_data),void 0,void 0)})}function a(a,b,c,d,e,f,g,h){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g,p,q,r,s,t){if(r!=null){var u=r.attachmentType;if(!((j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO))||(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))||(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))||(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE))||(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE))||(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA))))throw c("unrecoverableViolation")("We do not support forwarding this type","messenger_web_sharing");var v=null;if(!(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA))){isFinite(r.attachmentFbid)?v=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByMediaId",{description:"MAWForwardMessageFromSecureThread",mediaId:d("MAWDbMedia").convertNumberToMediaId(Number.parseInt(r.attachmentFbid,10))})):v=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByHashedPlaintextHash",{description:"MAWForwardMessageFromSecureThread",plaintextHash:d("WAHashUtils").stringToPlaintextHash(r.attachmentFbid)}));if(v==null)return}yield a.runInTransaction(function(f){switch(!0){case(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO)):if(v==null)throw c("unrecoverableViolation")("Blob can not be null for MessagingAttachmentType.AUDIO","messenger_web_sharing");var w=new File([v],"mediaForwardedFromSecureThread",{type:v.type}),x=d("OfflineThreadingId").createOfflineThreadingID();x=d("MWPComposerMediaUploadUtil").getAudioAttachment(x,w,(j||(j=d("I64"))).to_int32((x=r.playableDurationMs)!=null?x:(j||(j=d("I64"))).zero)/1e3,n(r.samplingFrequencyHz!=null?(j||(j=d("I64"))).to_int32(r.samplingFrequencyHz):void 0,r.waveformData));return o(a,x,w,g,e,q,s,f,t);case(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA)):return d("ReQL").firstAsync(d("ReQL").fromTableDescending(f.attachment_ctas).getKeyRange((x=r.defaultCtaId)!=null?x:(j||(j=d("I64"))).zero)).then(function(a){var e;if(c("gkx")("7418")){var f=r.xmaPreviewFbid;if(f==null){c("FBLogger")("messenger_web_sharing").mustfix("XMA preview fbid is null when forwarding XMA");return(h||(h=b("Promise"))).resolve([a,void 0])}if(c("gkx")("7858"))isFinite(r.xmaPreviewFbid)?(c("FBLogger")("messenger_web_sharing").warn("XMA preview fbid is not a plaintextHash when forwarding XMA"),e=d("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByMediaId",{description:"MAWForwardMessageFromSecureThread",mediaId:d("MAWDbMedia").convertNumberToMediaId(Number.parseInt(f,10))})):e=d("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByHashedPlaintextHash",{description:"MAWForwardMessageFromSecureThread",plaintextHash:d("WAHashUtils").stringToPlaintextHash(f)});else try{e=d("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByMediaId",{description:"MAWForwardMessageFromSecureThread",mediaId:d("MAWDbMedia").convertNumberToMediaId(Number.parseInt(f,10))})}catch(d){c("FBLogger")("messenger_web_sharing").mustfix("XMA preview fbid is not a valid mediaId when forwarding XMA %s",d);return(h||(h=b("Promise"))).resolve([a,void 0])}}else e=d("MAWBridgeSendAndReceive").sendAndReceive("backend","getBlobDataUrlByXMAId",{description:"MAWForwardMessageFromSecureThread",infoType:"preview",xmaId:d("MAWDbXMA").convertNumberToXMAId(Number.parseInt(r.attachmentFbid,10))});return e.then(function(c){return(h||(h=b("Promise"))).resolve([a,c])})["catch"](function(d){c("recoverableViolation")("Unable to getBlobDataUrlByXMAId, from MAWForwardMessageFromSecureThread","messenger_web_media",{error:d},{trackOnly:!0});return(h||(h=b("Promise"))).resolve([a,void 0])})}).then(function(a){var c=a[0];a=a[1];var h=null;a!=null&&(h=new File([a],"xmaForwardedFromSecureThread",{type:a.type}));a=d("OfflineThreadingId").createOfflineThreadingID();c=l(r,c,a,h);a=p.text;h=b("cr:2472")==null||a==null?a:b("cr:2472").unvault(a);return m(s,e,g,h,q,c,t,f)});case(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE)):case(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE)):case(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO)):case(j||(j=d("I64"))).equal(u,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE)):if(v==null)throw c("unrecoverableViolation")("Blob can not be null for MessagingAttachmentType.AUDIO","messenger_web_sharing");x=new File([v],(w=r.filename)!=null?w:"mediaForwardedFromSecureThread",{type:v.type});w=d("OfflineThreadingId").createOfflineThreadingID();w=k(r,w,x);return o(a,w,x,g,e,q,s,f,t);default:throw c("unrecoverableViolation")("We do not support forwarding this type","messenger_web_sharing")}},"readwrite",void 0,void 0,f.id+":330")}else{var w=p.text;if(w==null)throw c("unrecoverableViolation")("We do not support forwarding this type","messenger_web_sharing");var x=b("cr:2472")==null?w:b("cr:2472").unvault(w),y=x==="\ud83d\udc4d"&&p.hotEmojiSize!=null&&(j||(j=d("I64"))).equal(p.hotEmojiSize,(i||(i=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").SMALL)),z=y?(j||(j=d("I64"))).of_string("369239263222822"):void 0;yield a.runInTransaction(function(a){return c("LSOptimisticSendMessageV2StoredProcedure")(c("LSFactory")(a),{extraSendMessageParams:d("LSShape").ofRecord({calculate_denormalizations:!1,is_forwarded:q,mark_read:!1,power_up_style:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagePowerUp").NONE),source:t,sticker_id:z}),mailboxType:i.ofNumber(c("LSMailboxType").MESSENGER),senderId:s,text:y?void 0:x,threadKey:e,threadType:g})},"readwrite",void 0,void 0,f.id+":576")}});return p.apply(this,arguments)}g.getMediaAttachment=k;g.uploadAndSendMediaToOpenThread=o;g.forwardMessage=a}),98);
__d("forwardAttachmentFromInstamadilloToOpen",["I64","LSIntEnum","MAWForwardMessageFromSecureThread.react","OfflineThreadingId","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachmentFromInstamadilloToOpen");function a(a,b,c,d,e,f){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){var k=(yield j.load()),l=(yield k());k=d("OfflineThreadingId").createOfflineThreadingID();var m={attachment_fbid:k,attachment_index:(h||(h=d("I64"))).zero,attachment_type:a.attachmentType,filename:a.filename,has_media:!0,has_xma:!1,offline_attachment_id:k,playable_duration_ms:a.playableDurationMs,playable_url:URL.createObjectURL(b),playable_url_mime_type:b.type,preview_height:a.previewHeight,preview_url:URL.createObjectURL(b),preview_width:a.previewWidth};yield l.runInTransaction(function(a){return d("MAWForwardMessageFromSecureThread.react").uploadAndSendMediaToOpenThread(l,m,b,(i||(i=d("LSIntEnum"))).ofNumber(e),(h||(h=d("I64"))).of_string(c),!0,f,a,g)},"readwrite")});return k.apply(this,arguments)}g["default"]=a}),98);
__d("forwardAttachmentToInstamadillo",["I64","IGDBridgedAPI","LSFactory","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure","LSPendingTasksPluginType","LSShape","LSVec","OfflineThreadingId","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachmentToInstamadillo");function a(a,b,c,d,e,f,g){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k,l,m){var n=(yield j.load());n=(yield n());var o=d("OfflineThreadingId").createOfflineThreadingID(),p={attachment_fbid:o,attachment_index:(h||(h=d("I64"))).zero,attachment_type:a.attachmentType,filename:a.filename,has_media:!0,has_xma:!1,offline_attachment_id:o,playable_duration_ms:a.playableDurationMs,playable_url:URL.createObjectURL(e),playable_url_mime_type:e.type,preview_height:a.previewHeight,preview_url:URL.createObjectURL(e),preview_width:a.previewWidth};o=(yield n.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure")(c("LSFactory")(a),{extraSendMessageParams:d("LSShape").ofRecord({attachments:c("LSVec").ofArray([d("LSShape").ofRecord(p)]),is_forwarded:!0,mark_read:!1,plugin_type:(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO),source:l}),senderId:k,threadKey:(h||(h=d("I64"))).of_string(f),threadType:i.ofNumber(g)}));b=b[0];yield a.messages_optimistic_context.add({markThreadRead:!1,offlineThreadingId:b,openEb:m,taskId:h.of_string(b),threadAttributionSource:l,threadKey:h.of_string(f)});return b});return function(b){return a.apply(this,arguments)}}(),"readwrite"));yield c("IGDBridgedAPI").sendMediaMessage({offlineThreadingId:o});return o});return k.apply(this,arguments)}g["default"]=a}),98);
__d("LSOptimisticSendAttachmentForward",["LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSUpdateOptimisticAttachmentPreview"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[1]=a[3]===""?void 0:a[3],d[1]!==void 0?c.sequence([function(b){return c.forEach(c.filter(c.db.table(16).fetch([[[a[1],d[1]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&b.messageId===d[1]&&c.i64.eq(b.authorityLevel,c.i64.cast([0,20]))}),function(b){var d=b.update;b.item;return d({attachmentFbid:c.i64.to_string(a[7])})})},function(a){return d[0]=d[1]}]):c.sequence([function(e){return c.storedProcedure(b("LSLocalApplyOptimisticMessage"),a[0],a[1],a[2],a[4],a[5],a[6],void 0,void 0,void 0,void 0,c.i64.cast([0,3]),void 0,void 0,void 0,!0).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return c.filter(c.db.table(16).fetch(),function(b){return b.attachmentFbid===c.i64.to_string(a[7])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.storedProcedure(b("LSInsertOptimisticAttachment"),a[1],d[3],d[2],d[2],c.i64.to_string(a[7]),c.i64.cast([0,2]),void 0,void 0,!0,!1):(f=e.item,c.sequence([function(e){return c.storedProcedure(b("LSInsertOptimisticAttachment"),a[1],d[3],d[2],d[2],c.i64.to_string(a[7]),f.attachmentType,f.filename,f.attributionAppId,!0,!1)},function(e){return c.storedProcedure(b("LSUpdateOptimisticAttachmentPreview"),a[1],d[2],c.i64.to_string(a[7]),f.playableUrl,f.playableUrlFallback,f.playableUrlExpirationTimestampMs,f.playableUrlMimeType,f.previewUrl,f.previewUrlFallback,f.previewUrlExpirationTimestampMs,f.previewUrlMimeType,f.previewWidth,f.previewHeight)}]))})},function(a){return d[0]=d[2]}])},function(e){return c.sequence([function(b){return d[2]=c.createArray(),d[6]=(d[2].push(a[7]),d[2]),c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[3]=c.i64.cast([0,1]):(b=a.item,d[7]=b.syncGroup,c.i64.neq(d[7],void 0)?d[6]=d[7]:d[6]=c.i64.cast([0,1]),d[3]=d[6])})},function(e){return c.storedProcedure(b("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),c.i64.to_string(a[1]),c.i64.cast([0,46]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),d[3],void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[5]=a[0],a})},function(b){return c.db.table(31).add({taskId:d[5],threadKey:a[1],offlineThreadingId:d[0],threadAttributionSource:a[8],sendType:c.i64.cast([0,4]),markThreadRead:!1,initiatingSource:a[9]})}])},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxOptimisticSendAttachmentForwardStoredProcedure";a.__tables__=["attachments","threads","messages_optimistic_context"];e.exports=a}),null);
__d("LSOptimisticSendAttachmentForwardStoredProcedure",["LSOptimisticSendAttachmentForward","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e=c("LSOptimisticSendAttachmentForward")(e.senderId,e.threadKey,e.threadType,e.offlineThreadingId,e.text,e.snippet,e.snippetHasEmoji,e.forwardedAttachmentFbid,e.source,e.initiatingSource,a);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e))}g["default"]=a}),98);
__d("forwardAttachmentToOpen",["I64","LSFactory","LSIntEnum","LSOptimisticSendAttachmentForwardStoredProcedure","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachmentToOpen");function a(a,b,c,d,e){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var k=(yield j.load());k=(yield k());k=(yield k.runInTransaction(function(j){return c("LSOptimisticSendAttachmentForwardStoredProcedure")(c("LSFactory")(j),{forwardedAttachmentFbid:(h||(h=d("I64"))).of_string(a.attachmentFbid),senderId:f,source:g,threadKey:h.of_string(b),threadType:(i||(i=d("LSIntEnum"))).ofNumber(e)})},"readwrite"));k=k[0];return k});return k.apply(this,arguments)}g["default"]=a}),98);
__d("forwardAttachment",["FBLogger","I64","MAWDbMedia","MAWFowardMessageFromOpenThread","Promise","asyncToGeneratorRuntime","forwardAttachmentFromInstamadilloToOpen","forwardAttachmentToInstamadillo","forwardAttachmentToOpen","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardAttachment");function a(a,b,c,d,e,f){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k,l){var m=(yield j.load());m=(yield m());var n=(yield m.tables.e2ee_media.get(d("MAWDbMedia").convertToMediaId64((i||(i=d("I64"))).of_float(Number.parseInt(a.attachmentFbid,10))))),o=!1;if(n!=null){m=(yield m.tables.e2ee_chunk.index("hashedPlaintextHash").get(n.hashedPlaintextHash));if(m!=null){n=new Blob([m.blobData],{type:m.mimetype});m=new File([n],"IGDForwardFromSecureThread-"+a.attachmentFbid,{type:n.type});o=!0}else{c("FBLogger")("igd_web_on_msgr").mustfix("Missing chunk for e2ee media when forwarding an E2EE media message");return(h||(h=b("Promise"))).resolve()}}else{n=(yield d("MAWFowardMessageFromOpenThread").downloadMediaByUrl(a));m=n.file}if(Boolean(l==null?void 0:l.useInstamadilloTransport))return c("forwardAttachmentToInstamadillo")(a,m,e,f,g,k,Boolean(l==null?void 0:l.useOpenEb));else if(o)return c("forwardAttachmentFromInstamadilloToOpen")(a,m,e,f,g,k);else return c("forwardAttachmentToOpen")(a,e,f,g,k)});return k.apply(this,arguments)}g["default"]=a}),98);
__d("forwardText",["I64","LSFactory","LSIntEnum","LSMailboxType","LSOptimisticSendMessageV2StoredProcedure","LSPendingTasksPluginType","LSShape","MessagePowerUp","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardText"),k={calculate_denormalizations:!1,is_forwarded:!0,mark_read:!1,power_up_style:(h||(h=d("LSIntEnum"))).ofNumber(c("MessagePowerUp").NONE)};function a(a,b,c,d,e,f){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,l){var m=(yield j.load());m=(yield m());m=(yield m.runInTransaction(function(j){return c("LSOptimisticSendMessageV2StoredProcedure")(c("LSFactory")(j),{extraSendMessageParams:d("LSShape").ofRecord(babelHelpers["extends"]({},k,{openEb:l==null?void 0:l.useOpenEb,plugin_type:(l==null?void 0:l.useInstamadilloTransport)?(h||(h=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO):void 0,source:g})),mailboxType:(h||(h=d("LSIntEnum"))).ofNumber(c("LSMailboxType").MESSENGER),senderId:f,text:a.text,threadKey:(i||(i=d("I64"))).of_string(b),threadType:h.ofNumber(e)})},"readwrite"));m=m[0];return m});return l.apply(this,arguments)}g["default"]=a}),98);
__d("forwardXMAFromInstamadillo",["asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("getSendPostToInstamadilloRecipient").__setRef("forwardXMAFromInstamadillo"),i=c("requireDeferred")("getSendProfileToInstamadilloRecipient").__setRef("forwardXMAFromInstamadillo"),j=c("requireDeferred")("getSendReelToInstamadilloRecipient").__setRef("forwardXMAFromInstamadillo");function a(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){if(b==null)return;b=JSON.parse(b);switch(b.__typename){case"XMSGIgReceiverFetchXmaFeedFetchParams":var e=(yield h.load());e=e(b.media_igid,void 0,c,d,!0);yield e(a.id,a.isDisappearingModeSettingOn,a.isTTLCMediaShareEnabled);break;case"XMSGIgReceiverFetchXmaClipFetchParams":e=(yield j.load());e=e(b.media_igid,void 0,c,d,!0);yield e(a.id,a.isDisappearingModeSettingOn,a.isTTLCMediaShareEnabled);break;case"XMSGIgReceiverFetchXmaProfileFetchParams":e=(yield i.load());e=e(b.igid,void 0,c,d,!0);yield e(a.id,a.isDisappearingModeSettingOn,a.isTTLCGenericXMAShareEnabled);break}});return k.apply(this,arguments)}g["default"]=a}),98);
__d("forwardXMAFromOpenToInstamadillo",["FBLogger","I64","PolarisDirectAPI","PolarisLinkshimURI","URI","asyncToGeneratorRuntime","forwardXMAUtils","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("getSendPostToInstamadilloRecipient").__setRef("forwardXMAFromOpenToInstamadillo"),k=c("requireDeferred")("getSendProfileToInstamadilloRecipient").__setRef("forwardXMAFromOpenToInstamadillo"),l=function(a){var b=new(i||(i=c("URI")))(a);d("PolarisLinkshimURI").shouldSkipLinkShim(a)&&(b=new(i||(i=c("URI")))(b.getQueryData().u));return b.toString()};function a(a,b,c,d,e,f){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,i){g=l(g);if(d("forwardXMAUtils").isFeedXma(b.defaultCtaType,g)&&e!=null){var m=(yield j.load());m=m((h||(h=d("I64"))).to_string(e),void 0,f,g,!0);yield m(a.id,a.isDisappearingModeSettingOn,i)}if(d("forwardXMAUtils").isProfileXma(b.defaultCtaType,g)){if(f==null)return;try{e=(yield d("PolarisDirectAPI").getUserProfile(f));if(e.status==="ok"){m=(m=e.data)==null?void 0:(b=m.user)==null?void 0:b.id;b=(b=e.data)==null?void 0:(e=b.user)==null?void 0:e.eimu_id;if(m!=null&&b!=null){e=(yield k.load());e=e(m,b,f,g,!0);yield e(a.id,a.isDisappearingModeSettingOn,i)}}}catch(a){c("FBLogger")("igd_web_on_msgr").mustfix("forwardXMAFromOpenToInstamadillo: failed to call getUserProfile Django API",a);return}}});return m.apply(this,arguments)}g["default"]=a}),98);
__d("LSOptimisticSendMessageForward",["LSInsertOptimisticAttachment","LSIssueNewTaskWithExtraOperationsAndGetTaskID","LSLocalApplyOptimisticMessage","LSPredefineTraceForTask","LSUpdateOptimisticAttachmentPreview","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return d.filter(d.db.table(12).fetch([[[a[3],a[4],a[5]]]]),function(b){return d.i64.eq(b.threadKey,a[3])&&d.i64.eq(d.i64.cast([0,0]),d.i64.cast([0,0]))&&d.i64.eq(b.timestampMs,a[4])&&b.messageId===a[5]&&d.i64.eq(b.authorityLevel,d.i64.cast([0,80]))}).next().then(function(f,g){var h=f.done;f=f.value;return h?(e[3]=d.createArray(),e[4]=(e[3].push("optimisticSendMessageForward msg not found"),e[3]),e[5]=(e[3].push(a[5]),e[3]),e[6]=d.toJSON(e[3]),function(a){d.logger(a).mustfix(a)}(e[6]),h=["",d.i64.cast([-1,4294967295])],e[0]=h[0],e[1]=h[1],h):(g=f.item,d.sequence([function(f){return e[11]=g.forwardScore,e[3]=g.text,c("gkx")("24141")?(d.i64.neq(e[11],void 0)?e[12]=d.i64.lt(e[11],d.i64.cast([0,127])):e[12]=!0,d.i64.eq(a[0],g.senderId)||!e[12]?e[13]=e[11]:(d.i64.neq(e[11],void 0)?e[14]=d.i64.add(e[11],d.i64.cast([0,1])):e[14]=d.i64.cast([0,1]),e[13]=e[14]),e[4]=e[13]):e[4]=e[11],d.storedProcedure(b("LSLocalApplyOptimisticMessage"),a[0],a[1],a[2],e[3],void 0,void 0,g.stickerId,g.hotEmojiSize,void 0,void 0,d.i64.cast([0,3]),void 0,e[4],void 0,!0).then(function(a){return a=a,e[5]=a[0],e[6]=a[1],a})},function(c){return d.forEach(d.db.table(16).fetch([[[g.threadKey,g.messageId]]]),function(c){var f=c.item;return d.sequence([function(c){return e[16]=f.attachmentFbid,e[12]=d.createArray(),e[13]=(e[12].push(e[16]),e[12]),e[14]=(e[12].push(e[5]),e[12]),e[15]=d.toJSON(e[12]),d.storedProcedure(b("LSInsertOptimisticAttachment"),a[1],e[6],e[5],e[16],e[15],f.attachmentType,f.filename,void 0,f.hasMedia,f.hasXma)},function(c){return d.storedProcedure(b("LSUpdateOptimisticAttachmentPreview"),a[1],e[5],e[15],f.playableUrl,f.playableUrlFallback,f.playableUrlExpirationTimestampMs,f.playableUrlMimeType,f.previewUrl,f.previewUrlFallback,f.previewUrlExpirationTimestampMs,f.previewUrlMimeType,f.previewWidth,f.previewHeight)}])})},function(b){return d.db.table(9).fetch([[[a[1]]]]).next().then(function(b,c){var a=b.done;b=b.value;return a?e[7]=d.i64.cast([0,1]):(c=b.item,e[13]=c.syncGroup,d.i64.neq(e[13],void 0)?e[12]=e[13]:e[12]=d.i64.cast([0,1]),e[7]=e[12])})},function(c){return d.storedProcedure(b("LSIssueNewTaskWithExtraOperationsAndGetTaskID"),d.i64.to_string(a[1]),d.i64.cast([0,46]),"",void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),e[7],void 0,d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[9]=a[0],a})},function(a){return void 0!==void 0?d.storedProcedure(b("LSPredefineTraceForTask"),void 0,e[9],d.i64.to_string(d.i64.cast([0,46])),e[5]):d.resolve()},function(b){return d.db.table(31).add({taskId:e[9],threadKey:a[1],offlineThreadingId:e[5],messageId:a[5],threadAttributionSource:a[6],sendType:d.i64.cast([0,5]),markThreadRead:!1,initiatingSource:a[7]})},function(b){return e[12]=new d.Map(),e[13]=e[12].set("optimisticSendMessageForward",a[1]),e[14]=e[12].set("fwdMsgID",a[5]),e[15]=d.toJSON(e[12]),e[10]=e[15],function(a){d.logger(a).info(a)}(e[10]),b=[e[5],e[9]],e[0]=b[0],e[1]=b[1],b}]))})},function(a){return f[0]=e[0]}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSMailboxOptimisticSendMessageForwardStoredProcedure";a.__tables__=["messages","attachments","threads","messages_optimistic_context"];d=a;g["default"]=d}),98);
__d("LSOptimisticSendMessageForwardStoredProcedure",["LSOptimisticSendMessageForward","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e=c("LSOptimisticSendMessageForward")(e.senderId,e.threadKey,e.threadType,e.forwardedMsgThreadKey,e.forwardedMsgTimestampMs,e.forwardedMsgId,e.source,e.initiatingSource,a);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e))}g["default"]=a}),98);
__d("forwardXMAOpenToOpen",["I64","LSFactory","LSIntEnum","LSOptimisticSendMessageForwardStoredProcedure","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardXMAOpenToOpen");function a(a,b,c,d,e){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var k=(yield j.load());k=(yield k());k=(yield k.runInTransaction(function(j){return c("LSOptimisticSendMessageForwardStoredProcedure")(c("LSFactory")(j),{forwardedMsgId:a.messageId,forwardedMsgThreadKey:a.threadKey,forwardedMsgTimestampMs:a.timestampMs,senderId:f,source:g,threadKey:(h||(h=d("I64"))).of_string(b),threadType:(i||(i=d("LSIntEnum"))).ofNumber(e)})},"readwrite"));k=k[0];return k});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MWChatThreadId",["I64","LSIntEnum","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){switch(a.NAME){case"Group":case"User":case"Page":case"UserSecret":return a.VAL}}function b(a){switch(a.NAME){case"Group":return"g."+a.VAL;case"Page":return"p."+a.VAL;case"User":return"u."+a.VAL;case"UserSecret":throw c("unrecoverableViolation")("Not supported","messenger_web_product")}}function e(a){switch(a.targetType){case"GROUP":return{NAME:"Group",VAL:a.targetID};case"PAGE":return{NAME:"Page",VAL:a.targetID};case"USER":return{NAME:"User",VAL:a.targetID};default:throw c("unrecoverableViolation")("Invalid id","messenger_web_product")}}function f(a){return a.NAME==="User"}function j(a){return a.NAME==="UserSecret"}function k(a){if(a==null)return;a=a.split(":");if(a.length!==2)return;var b=a[0];a=a[1];switch(b){case"thread":return{NAME:"Group",VAL:a};case"user":return{NAME:"User",VAL:a};default:return}}function l(a){a=a.NAME;if(a==="Group")return(h||(h=d("LSIntEnum"))).ofNumber(2);return a==="User"||a==="Page"?(h||(h=d("LSIntEnum"))).ofNumber(1):(h||(h=d("LSIntEnum"))).ofNumber(7)}function m(a){return(i||(i=d("I64"))).of_string(a.VAL)}g.getFBID=a;g.serializeFuture=b;g.fromJs=e;g.isUser=f;g.isSecret=j;g.deserializeFromLegacyThreadId=k;g.getMessagingThreadType=l;g.toThreadKey=m}),98);
__d("useGetForwardSource",["LSIntEnum","LSMessagingThreadAttributionType","MWLSThreadDisplayContext"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext();if(a!=null)if(a==="Inbox")return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").MESSENGER_INBOX_FORWARD);else if(a==="ChatTab")return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").MESSENGER_CHAT_FORWARD);else return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").MESSENGER_BROADCAST_FLOW);else return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").MESSENGER_BROADCAST_FLOW)}g["default"]=a}),98);
__d("WorkChatMessageType",[],(function(a,b,c,d,e,f){"use strict";a="text";b="gif";c="sticker";d="audio";e="file";f.text=a;f.gif=b;f.sticker=c;f.audio=d;f.file=e}),66);
__d("useMWLSSendStickerMessage",["I64","Int64Hooks","LSFactory","LSIntEnum","LSMailboxType","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSOptimisticSendMessageV2StoredProcedure","LSShape","LSThreadAttributionTypeUtil","MWPActor.react","MessagePowerUp","WorkChatMessageType","promiseDone","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,e){var g=(j||(j=c("useReStore")))(),k=d("MWPActor.react").useActor();return d("Int64Hooks").useCallbackInt64(function(j,l,m){c("promiseDone")(g.runInTransaction(function(e){var f;f=d("LSThreadAttributionTypeUtil").getSource(j,(f=a)!=null?f:"unknown");return c("LSOptimisticSendMessageV2StoredProcedure")(c("LSFactory")(e),{extraSendMessageParams:d("LSShape").ofRecord({calculate_denormalizations:!0,initiating_source:b,mark_read:!0,optimistic_attachment_preview:d("LSShape").ofRecord({playable_url:void 0,playable_url_expiration_timestamp_ms:void 0,playable_url_fallback:void 0,playable_url_mime_type:void 0,preview_height:(h||(h=d("I64"))).zero,preview_url:m,preview_url_expiration_timestamp_ms:void 0,preview_url_fallback:void 0,preview_url_mime_type:void 0,preview_width:h.zero}),power_up_style:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagePowerUp").NONE),reply_source_id:void 0,reply_source_type:i.ofNumber(c("LSMessageReplySourceType").MESSAGE),reply_source_type_v2:i.ofNumber(c("LSMessageReplySourceTypeV2").MESSAGE),snippet_has_emoji:!1,source:f,sticker_id:h.of_string(l)}),mailboxType:i.ofNumber(c("LSMailboxType").MESSENGER),senderId:k,threadKey:j,threadType:i.ofNumber(1)})},"readwrite",void 0,void 0,f.id+":49").then(function(a){e==null?void 0:e(d("WorkChatMessageType").sticker,1,a[0])}))},[g,k,b,a,e])}g["default"]=a}),98);
__d("MWLSForwardMessage",["I64","Int64Hooks","LSFactory","LSMediaUrlAttachment","LSOptimisticSendAttachmentForwardStoredProcedure","LSOptimisticSendMessageForwardStoredProcedure","MWChatThreadId","MWPActor.react","ODS","Promise","ReQL","promiseDone","useGetForwardSource","useLSMessagingInitiatingSource","useLSMessagingSource","useMWLSSendStickerMessage","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(){var a=(k||(k=c("useReStore")))(),e=d("MWPActor.react").useActor(),g=c("useLSMessagingInitiatingSource")(),l=c("useGetForwardSource")(),m=c("useLSMessagingSource")(),n=c("useMWLSSendStickerMessage")(m,g);return d("Int64Hooks").useCallbackInt64(function(k,m,o){if(o.type!=="sent")return;o=o.value;var p=o.timestamp,q=o.messageId,r=o.threadId;(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","send");var s=function(){return a.runInTransaction(function(a){return c("LSOptimisticSendMessageForwardStoredProcedure")(c("LSFactory")(a),{forwardedMsgId:q,forwardedMsgThreadKey:r,forwardedMsgTimestampMs:p,initiatingSource:g,senderId:e,source:l,threadKey:k,threadType:m})},"readwrite",void 0,void 0,f.id+":62").then(function(){})};c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.messages).getKeyRange(r,p,q)).then(function(c){if(c==null)return s();var e=c.stickerId;if(e!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.attachments).getKeyRange(r,q)).then(function(a){a=a!=null?d("LSMediaUrlAttachment").previewUrl(a):void 0;n(k,(j||(j=d("I64"))).to_string(e),a);return(h||(h=b("Promise"))).resolve()});else return s()}),function(){return(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","success")},function(){return(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","failure")});return},[a,e,g,l,n])}function e(){var a=(k||(k=c("useReStore")))(),b=d("MWPActor.react").useActor(),e=c("useLSMessagingInitiatingSource")(),g=c("useGetForwardSource")();return d("Int64Hooks").useMemoInt64(function(){return function(h,k,l){(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","send");var m=d("MWChatThreadId").getMessagingThreadType(h),n=d("MWChatThreadId").toThreadKey(h);c("promiseDone")(a.runInTransaction(function(a){return c("LSOptimisticSendAttachmentForwardStoredProcedure")(c("LSFactory")(a),{forwardedAttachmentFbid:(j||(j=d("I64"))).of_string(k),initiatingSource:e,senderId:b,source:g,threadKey:n,threadType:m})},"readwrite",void 0,void 0,f.id+":140"),function(){return(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","success")},function(){return(i||(i=d("ODS"))).bumpEntityKey(3185,"mw_forward","failure")})}},[a,b,e,g])}g.useForwardMessage=a;g.useForwardAttachment=e}),98);
__d("useMWV2ForwardMessage",["$InternalEnum","CometRelay","FBLogger","I64","Int64Hooks","LSIntEnum","LSMessagingThreadTypeUtil","MAWDbMsg","MAWExternalId","MAWMessageSendReporterV2","MAWThreadId","MAWVerifyThreadCutover","MWChatMessageId","MWChatThreadId","MWLSForwardMessage","MWPActor.react","MWSharedMsgLogUtils","Promise","ReQL","ReQLSuspense","asyncToGeneratorRuntime","cr:9756","cr:9757","cr:9758","cr:9759","gkx","promiseDone","sendToSentQPLLogger","unrecoverableViolation","useGetForwardSource","useIsSecureMessage","useLSMessagingSource","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(b))}function m(a,b,c){var e;return(e=d("ReQL")).firstAsync(e.mergeJoin(e.fromTableAscending(a.tables.participants).getKeyRange(b),e.fromTableAscending(a.tables.contacts)).filter(function(a){a[0];a=a[1];return!(k||(k=d("I64"))).equal(a.id,c)}))}function n(a,b,c){var e=b.messageId,g=b.threadKey;b=d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(a.tables.attachments).getKeyRange(g,e)},[a,e,g],f.id+":100");var h=d("ReQLSuspense").useFirst(function(){return c!=null?d("ReQL").fromTableAscending(a.tables.attachments).getKeyRange(g,e,c):d("ReQL").empty()},[c,a,e,g],f.id+":109"),i=b.length>0?b[0]:void 0;if(c!=null){h=(h=h)!=null?h:i;return h!=null?[h]:[]}return b}function o(){var a=(j||(j=c("useReStore")))();return d("Int64Hooks").useCallbackInt64(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e,f,g,i,j,k,n,o){var q=d("MWChatThreadId").toThreadKey(j),r=d("MWChatThreadId").getMessagingThreadType(j);j=(yield d("MAWVerifyThreadCutover").verifyThreadCutover((h||(h=b("Promise"))).resolve(a),q));var s=(yield h.all([d("MAWThreadId").isSecureThreadId(a.tables,q),l(a,q),m(a,q,g)])),t=s[0],u=s[1];s=s[2];t=t||j;try{if(b("cr:9757")!=null&&!t){d("sendToSentQPLLogger").addSendToSentAnnotations(k,{string:{forward_type:p.SecureToOpen}});o!=null?yield (h||(h=b("Promise"))).allSettled([o.messagesAndAttachments.map(function(c){return b("cr:9757").forwardMessage(a,q,r,c.message,i,(c=c.attachment)!=null?c:void 0,g,n)})]):yield b("cr:9757").forwardMessage(a,q,r,e,i,f[0],g,n);d("sendToSentQPLLogger").markSendToSentSuccess(k);return}j=d("MAWDbMsg").toMsgId(e.messageId);if(j==null)throw c("unrecoverableViolation")("Message does not have an id","messenger_web_sharing");if(b("cr:9756")!=null){d("sendToSentQPLLogger").addSendToSentAnnotations(k,{string:{forward_type:p.SecureToSecure}});if(o!=null){t=o.messagesAndAttachments.map(function(a){return d("MAWDbMsg").toMsgId(a.message.messageId)}).filter(Boolean);yield b("cr:9756").forwardMessageBatch(a,q,t,n,k)}else yield b("cr:9756").forwardMessage(a,q,j,n,k);if(b("cr:9759")!=null&&u!=null)return b("cr:9759")(a,u,s,d("LSMessagingThreadTypeUtil").isOneToOne(u.threadType));return}throw c("unrecoverableViolation")("We won't reach to this step, if you are in QE, you should use secure forward","messenger_web_sharing")}catch(a){d("sendToSentQPLLogger").markSendToSentFail(k,"failed_forwarding_message",a);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("MW Fail forwarding a message");throw a}});return function(a,b,c,d,f,g,h,i){return e.apply(this,arguments)}}(),[a])}var p=b("$InternalEnum")({SecureToOpen:"secure_to_open",OpenToOpen:"open_to_open",SecureToSecure:"secure_to_secure",OpenToSecure:"open_to_secure"});function a(a,e,f,g){var q=(j||(j=c("useReStore")))(),r=n(q,a,f),s=c("useIsSecureMessage")(q,a,{fallbackThreadType:e}),t=d("MWPActor.react").useActor(),u=!(k||(k=d("I64"))).equal(t,a.senderId),v=d("MWLSForwardMessage").useForwardMessage(),w=d("MWLSForwardMessage").useForwardAttachment(),x=c("useGetForwardSource")(),y=d("MWChatMessageId").makeSent(k.to_string(a.threadKey),a.messageId,k.to_string(a.timestampMs)),z=d("CometRelay").useRelayEnvironment(),A=o(),B=d("MWSharedMsgLogUtils").getMessageTypeFromDisplayedContentType(a.displayedContentTypes),C=c("useLSMessagingSource")(),D=d("Int64Hooks").useCallbackInt64(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=d("MWChatThreadId").toThreadKey(b);c=(yield d("MAWThreadId").getThreadFromJid(q.tables,c));c=d("sendToSentQPLLogger").markSendToSentStartWithAnnotation(c,{mediaGroupInfo:g},(i||(i=d("LSIntEnum"))).unwrapIntEnum(x),{string:{attachment_type:"forward",message_type:B}});yield A(a,r,t,u,b,c,x,g)});return function(a){return c.apply(this,arguments)}}(),[q,t,g,x,A,a,r,u,B]),E=d("Int64Hooks").useCallbackInt64(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var j=d("MWChatThreadId").toThreadKey(e),k=d("MWChatThreadId").getMessagingThreadType(e),n=(yield (h||(h=b("Promise"))).all([d("MAWThreadId").isSecureThreadId(q.tables,j),l(q,j),m(q,j,t),d("MAWVerifyThreadCutover").verifyThreadCutover(h.resolve(q),j),d("MAWThreadId").getThreadFromJid(q.tables,j)])),o=n[0],s=n[1],A=n[2],D=n[3],E=n[4];n=o||D;var F=function(){var a=d("sendToSentQPLLogger").markSendToSentStart();if(E!=null){var b=d("MWSharedMsgLogUtils").getMessageTypeParams({threadType:E.threadType});c("promiseDone")(d("MWSharedMsgLogUtils").getSendToSentAnnotations(E,b,(i||(i=d("LSIntEnum"))).unwrapIntEnum(x)),function(b){b.string=babelHelpers["extends"]({},b.string,{attachment_type:"forward",message_type:B}),d("sendToSentQPLLogger").addSendToSentAnnotations(a,b)})}d("sendToSentQPLLogger").addSendToSentAnnotations(a,{string:{forward_type:p.OpenToSecure,message_type:B}});return a};if(b("cr:9758")!=null&&n){var G=function(c,d){return function(e){return b("cr:9758").forwardMessage(z,q,j,a,u,d,x,(e=e)!=null?e:void 0,c)}};if(r.length===0){o=d("MAWExternalId").generateExternalId();if(c("gkx")("8783"))c("promiseDone")(d("MAWMessageSendReporterV2").MAWMessageSendReporterV2({composerEntrypoint:"useMWV2ForwardMessage",externalId:o,extraAnnotations:{string:{attachment_type:"forward",forward_type:p.OpenToSecure,message_type:B}},lsSource:C,messageTypeParamsArgs:{mediaGroupInfo:g},thread:E},G(o,void 0),q));else{D=F();yield G(o,void 0)(D);d("sendToSentQPLLogger").markSendToSentSuccess(D)}}else yield (h||(h=b("Promise"))).all(r.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("MAWExternalId").generateExternalId();if(c("gkx")("8783"))yield d("MAWMessageSendReporterV2").MAWMessageSendReporterV2({composerEntrypoint:"useMWV2ForwardMessage",externalId:b,extraAnnotations:{string:{attachment_type:"forward",forward_type:p.OpenToSecure,message_type:B}},lsSource:C,messageTypeParamsArgs:{mediaGroupInfo:g},thread:E},G(b,a),q);else{var e=F();try{yield G(b,a)(e),d("sendToSentQPLLogger").markSendToSentSuccess(e)}catch(a){d("sendToSentQPLLogger").markSendToSentFail(e,"failed_forwarding_message",a);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("MW Fail forwarding a message");throw a}}});return function(b){return a.apply(this,arguments)}}()));b("cr:9759")!=null&&s!=null&&b("cr:9759")(q,s,A,d("LSMessagingThreadTypeUtil").isOneToOne(s.threadType))}else if(!n){o=F();try{d("sendToSentQPLLogger").addSendToSentAnnotations(o,{string:{forward_type:p.OpenToOpen,message_type:B}});f==null?v(j,k,y):w(e,f);d("sendToSentQPLLogger").markSendToSentSuccess(o);return}catch(a){d("sendToSentQPLLogger").markSendToSentFail(o,"failed_forwarding_message",a);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("MW Fail forwarding a message");throw a}}});return function(a){return e.apply(this,arguments)}}(),[q,t,x,f,z,a,u,g,C,r,v,y,w,B]);return d("Int64Hooks").useMemoInt64(function(){return s?D:E},[s,D,E])}g.ForwardType=p;g.useMWV2ForwardMessage=a}),98);
__d("forwardXMA",["I64","IGDInstamadilloUtils","asyncToGeneratorRuntime","forwardText","forwardXMAFromInstamadillo","forwardXMAFromOpenToInstamadillo","forwardXMAOpenToOpen","forwardXMAUtils","requireDeferred","sendToSentQPLLogger","useMWV2ForwardMessage"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("forwardXMA");function a(a,b,c,d,e,f,g,h){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,j,k,l){var m,n=b.defaultCtaId;if(n==null)return;var o=(yield i.load());o=(yield o());n=(yield o.tables.attachment_ctas.get(n));m=(m=b.headerTitle)!=null?m:b.titleText;var p=n==null?void 0:n.actionUrl,q=n==null?void 0:n.targetId;if(p==null)return;o=(yield o.tables.threads.get((h||(h=d("I64"))).of_string(k.id)));o=d("forwardXMAUtils").shouldForwardXMAViaTTLC(o,a,b,n);n=k.isInstamadilloCutover||k.isDisappearingModeSettingOn||o;var r=d("IGDInstamadilloUtils").isInstamadilloMessage(a)?n?d("useMWV2ForwardMessage").ForwardType.SecureToSecure:d("useMWV2ForwardMessage").ForwardType.SecureToOpen:n?d("useMWV2ForwardMessage").ForwardType.OpenToSecure:d("useMWV2ForwardMessage").ForwardType.OpenToOpen;d("sendToSentQPLLogger").addSendToSentAnnotations(l,{bool:{use_instamadillo_transport:n,use_open_eb:o}});switch(r){case d("useMWV2ForwardMessage").ForwardType.OpenToSecure:return c("forwardXMAFromOpenToInstamadillo")(k,b,q,m,p,o);case d("useMWV2ForwardMessage").ForwardType.SecureToSecure:return c("forwardXMAFromInstamadillo")(k,a.xmaReceiverFetchParams,m,p);case d("useMWV2ForwardMessage").ForwardType.SecureToOpen:return c("forwardText")(babelHelpers["extends"]({},a,{text:p}),e,f,g,j);case d("useMWV2ForwardMessage").ForwardType.OpenToOpen:return c("forwardXMAOpenToOpen")(a,e,f,g,j)}});return j.apply(this,arguments)}g["default"]=a}),98);
__d("useIGDForwardMessage",["FBLogger","I64","IGDThreadTTLCUtils","LSBitFlag","LSIntEnum","MWPActor.react","MessagingAttachmentType","ReQL","asyncToGeneratorRuntime","forwardAttachment","forwardAttachmentToOpen","forwardText","forwardXMA","react-compiler-runtime","sendToSentQPLLogger","useAsyncReStore","useGetForwardSource"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,c,d,e,f){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,j){var k=e.candidate;e=e.type;var l=k.id;e=e==="thread"?2:1;l=(yield a.tables.threads.get((h||(h=d("I64"))).of_string(l)));var m=k.isInstamadilloCutover||k.isDisappearingModeSettingOn;if(d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(1),b.displayedContentTypes)){var n=d("IGDThreadTTLCUtils").isInstamadilloTTLCTextEnabled(l),o=m||n;d("sendToSentQPLLogger").addSendToSentAnnotations(j,{bool:{use_instamadillo_transport:o,use_open_eb:n}});return c("forwardText")(b,k.id,e,f,g,{useInstamadilloTransport:o,useOpenEb:n})}o=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.attachments).getKeyRange(b.threadKey,b.messageId)));if(o!=null){n=(i||(i=d("LSIntEnum"))).unwrapIntEnum(o.attachmentType);if(n===c("MessagingAttachmentType").XMA)return c("forwardXMA")(b,o,k.id,e,f,g,k,j);else if(n===c("MessagingAttachmentType").ANIMATED_IMAGE)return c("forwardAttachmentToOpen")(o,k.id,e,f,g);else{a=!1;n===c("MessagingAttachmentType").IMAGE?a=d("IGDThreadTTLCUtils").isInstamadilloTTLCImageEnabled(l):n===c("MessagingAttachmentType").VIDEO?a=d("IGDThreadTTLCUtils").isInstamadilloTTLCVideoEnabled(l):n===c("MessagingAttachmentType").AUDIO&&(a=d("IGDThreadTTLCUtils").isInstamadilloTTLCAudioEnabled(l));b=m||a;d("sendToSentQPLLogger").addSendToSentAnnotations(j,{bool:{use_instamadillo_transport:b,use_open_eb:a}});return c("forwardAttachment")(o,k.id,e,f,g,{useInstamadilloTransport:b,useOpenEb:a})}}});return k.apply(this,arguments)}function a(a){var e=d("react-compiler-runtime").c(5),f=c("useAsyncReStore")(),g=c("useGetForwardSource")(),h=d("MWPActor.react").useActor(),i;e[0]!==f||e[1]!==a||e[2]!==h||e[3]!==g?(i=function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=d("sendToSentQPLLogger").markSendToSentStart();d("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{attachment_type:"forward",message_type:"forward"}});try{yield j(yield f,a,b,h,g,e),d("sendToSentQPLLogger").markSendToSentSuccess(e)}catch(a){b=a;d("sendToSentQPLLogger").markSendToSentFail(e,"message_send_fail",b);c("FBLogger")("igd_web_on_msgr").catching(b).mustfix("IGD failure forwarding a message")}});return function(a){return e.apply(this,arguments)}}(),e[0]=f,e[1]=a,e[2]=h,e[3]=g,e[4]=i):i=e[4];return i}g["default"]=a}),98);
__d("useIGDMessageForwardMenuItem.react",["fbt","I64","IGDContactSearchDialogType.flow","IGDInstamadilloUtils","IGDMessageContextMenuItem.react","IGDSDialogPlaceholder.react","IGDSDirectOutlineIcon.react","IGDThreadListNewMessageLoggingDataContext","JSResourceForInteraction","LSBitFlag","LSContactBitOffset","LSContactBlockedByViewerStatus","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MWLSThread","MWPActor.react","MessagingAttachmentType","MessengerWebUXLogger","Promise","ReQL","ReQLSuspense","asyncToGeneratorRuntime","getInstamadilloLoggingExtraData","qex","react","react-compiler-runtime","useIGDForwardMessage","useIGDMessageAttachment","useIGDSLazyDialog","useIsReadOnlyFeatureLimited","useIsThreadBlocked","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m,n=m||d("react"),o=function(){return c("qex")._("121")===!0};function a(a,e){var g=d("react-compiler-runtime").c(20),m=(j||(j=c("useReStore")))(),q=d("MWPActor.react").useActor(),r=a.displayedContentTypes,s=a.senderId,t=a.threadKey,u=c("useIsReadOnlyFeatureLimited")(),v=c("useIsThreadBlocked")(),w=d("MWLSThread").useThreadExn(a.threadKey),x=w.threadType,y;g[0]!==m.tables.contacts||g[1]!==s?(y=function(){return d("ReQL").fromTableAscending(m.tables.contacts).getKeyRange(s)},g[0]=m.tables.contacts,g[1]=s,g[2]=y):y=g[2];var z;g[3]!==m||g[4]!==s?(z=[m,s],g[3]=m,g[4]=s,g[5]=z):z=g[5];y=d("ReQLSuspense").useFirst(y,z,f.id+":67");z=y!=null&&d("LSContactBitOffset").has(66,y);var A=d("LSThreadBitOffset").has(103,w),B=d("LSMessagingThreadTypeUtil").isIGDMessageRequest(w),C=(k||(k=d("I64"))).equal(a.displayedContentTypes,(l||(l=d("LSIntEnum"))).ofNumber(256));q=k.equal(s,q);q=!q&&d("LSMessagingThreadTypeUtil").isOneToOne(x)&&y!=null?!(k||(k=d("I64"))).equal(y.blockedByViewerStatus,(l||(l=d("LSIntEnum"))).ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED)):!1;y=c("useIGDMessageAttachment")(m,a,t);t=y.attachment;y=y.hasMultipleAttachments;var D=t!=null&&((k||(k=d("I64"))).equal(t.attachmentType,(l||(l=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").EPHEMERAL_IMAGE))||(k||(k=d("I64"))).equal(t.attachmentType,(l||(l=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").EPHEMERAL_VIDEO))),E=t!=null&&(k||(k=d("I64"))).equal(t.attachmentType,(l||(l=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO)),F=t!=null&&(k||(k=d("I64"))).equal(t.attachmentType,(l||(l=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER)),G=t!=null&&(k||(k=d("I64"))).equal(t.attachmentType,(l||(l=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA))?t.isSharable:!0;t=t!=null&&(k||(k=d("I64"))).equal(t.attachmentType,(l||(l=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA))&&t.stickerType==="ai_generated_sticker";r=(k||(k=d("I64"))).equal(r,d("LSBitFlag").empty)&&!D;var H=c("useIGDForwardMessage")(a),I=c("MessengerWebUXLogger").useInteractionLogger(),J=d("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),K;g[6]===Symbol["for"]("react.memo_cache_sentinel")?(K=c("JSResourceForInteraction")("IGDAWOminipickerDialog.react").__setRef("useIGDMessageForwardMenuItem.react"),g[6]=K):K=g[6];K=c("useIGDSLazyDialog")(K,p);var L=K[0];K=d("IGDInstamadilloUtils").isInstamadilloMessage(a)&&a.ephemeralDurationInSec!=null&&(k||(k=d("I64"))).gt(a.ephemeralDurationInSec,(k||(k=d("I64"))).zero);v=!v&&!z&&!B&&!u&&!a.isUnsent&&!r&&(d("LSMessagingThreadTypeUtil").isArmadilloSecure(x)?o():!0)&&A&&G&&!q&&!C&&!D&&!E&&!K&&!y&&!F&&!t;if(!v)return null;g[7]!==H?(z=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=Array.from(a.values()).map(function(a){return H(a)});yield (i||(i=b("Promise"))).allSettled(a)});return function(b){return a.apply(this,arguments)}}(),g[7]=H,g[8]=z):z=g[8];var M=z;g[9]!==J||g[10]!==I||g[11]!==e||g[12]!==M||g[13]!==L||g[14]!==w?(B=function(){I==null?void 0:I({eventName:"message_forward",extraData:c("getInstamadilloLoggingExtraData")(w),flowInstanceId:J}),L({includeGroup:!0,loggingEventName:"forward_thread_attempt",maxRecipients:5,onSubmit:M,searchType:d("IGDContactSearchDialogType.flow").IGDContactSearchDialogType.FORWARD_MESSAGE,submitButtonLabel:h._("__JHASH__Mg5C78xztSX__JHASH__").toString(),titleLabel:h._("__JHASH__y0z31BBozLu__JHASH__").toString()},e)},g[9]=J,g[10]=I,g[11]=e,g[12]=M,g[13]=L,g[14]=w,g[15]=B):B=g[15];u=B;g[16]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._("__JHASH__YherSGbeO3h__JHASH__"),g[16]=a):a=g[16];r=a;g[17]===Symbol["for"]("react.memo_cache_sentinel")?(x=n.jsx(c("IGDSDirectOutlineIcon.react"),{alt:r,size:18}),g[17]=x):x=g[17];g[18]!==u?(A=n.jsx(c("IGDMessageContextMenuItem.react"),{icon:x,label:r,onClick:u,testid:void 0}),g[18]=u,g[19]=A):A=g[19];return A}function p(a){return n.jsx(c("IGDSDialogPlaceholder.react"),{fixedHeight:!0,onClose:a,size:"large"})}p.displayName=p.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("useIGDMessageInspectMenuItem.react",["fbt","IGDMessageContextMenuItem.react","IGDSSearchPanoOutlineIcon.react","JSResourceForInteraction","gkx","react","react-compiler-runtime","useIGDSLazyDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));i.useCallback;function a(a){var b=d("react-compiler-runtime").c(8),e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=h._("__JHASH__mew0ZCK-3iQ__JHASH__"),b[0]=e):e=b[0];e=e;var f;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(f=c("JSResourceForInteraction")("IGDMessageInspectMessageDialog.react").__setRef("useIGDMessageInspectMenuItem.react"),b[1]=f):f=b[1];f=c("useIGDSLazyDialog")(f);var g=f[0];b[2]!==a||b[3]!==g?(f=function(){g({message:a})},b[2]=a,b[3]=g,b[4]=f):f=b[4];f=f;var i=c("gkx")("24015");if(!i)return null;b[5]===Symbol["for"]("react.memo_cache_sentinel")?(i=j.jsx(c("IGDSSearchPanoOutlineIcon.react"),{alt:e,size:18}),b[5]=i):i=b[5];b[6]!==f?(i=j.jsx(c("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:i,label:e,onClick:f,testid:void 0}),b[6]=f,b[7]=i):i=b[7];return i}g["default"]=a}),226);
__d("useIGDMessageNegativeFeedbackMenuItem.react",["fbt","IGDMessageContextMenuItem.react","IGDSDialogPlaceholder.react","IGDSThumbDownPanoOutline24Icon.react","JSResourceForInteraction","emptyFunction","react","react-compiler-runtime","useGenAIFeedbackSubmissionStatus","useIGDIsGenAiReelsPlugin","useIGDSLazyDialog","useIGDSToaster","useMWV2SubmitFeedbackAction"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));i.useCallback;function a(a){var b=d("react-compiler-runtime").c(11),e=c("useIGDSToaster")(),f;b[0]!==e?(f=function(){e.add({message:h._("__JHASH__szyqZwWEpgN__JHASH__"),target:"bottom-left"})},b[0]=e,b[1]=f):f=b[1];f=f;var g=c("useMWV2SubmitFeedbackAction")(a.botResponseId,f);b[2]===Symbol["for"]("react.memo_cache_sentinel")?(f=c("JSResourceForInteraction")("MWV2SubmitNegativeFeedbackDialog.react").__setRef("useIGDMessageNegativeFeedbackMenuItem.react"),b[2]=f):f=b[2];f=c("useIGDSLazyDialog")(f,k);var i=f[0];b[3]!==a||b[4]!==g||b[5]!==i?(f=function(){i({message:a,onSubmit:g},c("emptyFunction"))},b[3]=a,b[4]=g,b[5]=i,b[6]=f):f=b[6];f=f;var l=c("useGenAIFeedbackSubmissionStatus")(a.botResponseId),m=c("useIGDIsGenAiReelsPlugin")(a);if(l==null||m)return null;b[7]===Symbol["for"]("react.memo_cache_sentinel")?(l=h._("__JHASH__7ndOyL_QgDy__JHASH__"),b[7]=l):l=b[7];m=l;b[8]===Symbol["for"]("react.memo_cache_sentinel")?(l=j.jsx(c("IGDSThumbDownPanoOutline24Icon.react"),{alt:m,size:18}),b[8]=l):l=b[8];b[9]!==f?(l=j.jsx(c("IGDMessageContextMenuItem.react"),{icon:l,label:m,onClick:f}),b[9]=f,b[10]=l):l=b[10];return l}function k(a){return j.jsx(c("IGDSDialogPlaceholder.react"),{fixedHeight:!0,onClose:a,size:"large"})}k.displayName=k.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("useIGDMessagePositiveFeedbackMenuItem.react",["fbt","BotFeedbackKind","IGDMessageContextMenuItem.react","IGDSThumbUpPanoOutline24Icon.react","IGDThreadListNewMessageLoggingDataContext","MessengerWebUXLogger","react","react-compiler-runtime","useGenAIFeedbackSubmissionStatus","useIGDIsGenAiReelsPlugin","useIGDSToaster","useMWV2SubmitFeedbackAction"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;b.useMemo;function a(a,b){var e,f=d("react-compiler-runtime").c(16),g=c("useIGDSToaster")(),i;f[0]!==g?(i=function(){g.add({message:h._("__JHASH__szyqZwWEpgN__JHASH__"),target:"bottom-left"})},f[0]=g,f[1]=i):i=f[1];i=i;var k=c("useMWV2SubmitFeedbackAction")(a.botResponseId,i);i=d("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext();e=(e=a.botResponseId)!=null?e:"";var l;f[2]!==e?(l={botResponseId:e},f[2]=e,f[3]=l):l=f[3];f[4]!==i||f[5]!==l?(e={extraData:l,flowInstanceId:i},f[4]=i,f[5]=l,f[6]=e):e=f[6];i=e;var m=i,n=c("MessengerWebUXLogger").useInteractionLogger();f[7]!==m||f[8]!==n||f[9]!==b||f[10]!==k?(l=function(){k(c("BotFeedbackKind").BOT_FEEDBACK_POSITIVE),n==null?void 0:n(babelHelpers["extends"]({eventName:"submit_positive_feedback"},m)),b()},f[7]=m,f[8]=n,f[9]=b,f[10]=k,f[11]=l):l=f[11];e=l;i=c("useGenAIFeedbackSubmissionStatus")(a.botResponseId);l=c("useIGDIsGenAiReelsPlugin")(a);if(i==null||l)return null;f[12]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._("__JHASH__FtoE8geHXMB__JHASH__"),f[12]=a):a=f[12];i=a;f[13]===Symbol["for"]("react.memo_cache_sentinel")?(l=j.jsx(c("IGDSThumbUpPanoOutline24Icon.react"),{alt:i,size:18}),f[13]=l):l=f[13];f[14]!==e?(a=j.jsx(c("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:l,label:i,onClick:e}),f[14]=e,f[15]=a):a=f[15];return a}g["default"]=a}),226);
__d("useIGDMessageReaction.react",["fbt","EmojiFormat.bs","IGDThreadListNewMessageLoggingDataContext","Int64Hooks","MWLSThread","MWV2MessageReactionHooks","MessengerWebUXLogger","UnicodeUtils","asyncToGeneratorRuntime","emptyFunction","getInstamadilloLoggingExtraData","promiseDone","react","react-compiler-runtime","useAsyncReStore","useIGDGlobalReactMessage"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;(i||d("react")).useCallback;function a(a,e){var f=d("react-compiler-runtime").c(17),g=d("MWV2MessageReactionHooks").MWV2MessageReactionHooks.useSelectedReaction(a.messageId,a.threadKey),i=c("useIGDGlobalReactMessage")(a,"reaction_tray"),k;f[0]!==e||f[1]!==g||f[2]!==i?(k=function(a){var b=d("EmojiFormat.bs").codeArrayToUnicode(a);if(g!=null){var f=(j||(j=d("UnicodeUtils"))).getCodePoints(g);b===g&&(b=void 0);f[0]===10084&&a[0]===10084&&(b=void 0)}c("promiseDone")(i(b,"reaction"));e()},f[0]=e,f[1]=g,f[2]=i,f[3]=k):k=f[3];k=k;var l;f[4]!==k?(l={closeAfterSelect:!0,onClose:c("emptyFunction"),onSelect:k,showPopoverArrow:!1},f[4]=k,f[5]=l):l=f[5];k=l;f[6]===Symbol["for"]("react.memo_cache_sentinel")?(l=h._("__JHASH__lHWykrNu5cj__JHASH__"),f[6]=l):l=f[6];l=l;var m=c("useAsyncReStore")(),n=c("MessengerWebUXLogger").useInteractionLogger(),o=d("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),p,q;f[7]!==m||f[8]!==o||f[9]!==n||f[10]!==a.messageId||f[11]!==a.threadKey?(p=function(e){c("promiseDone")(m.then(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield d("MWLSThread").getThreadAsync(b,a.threadKey));b&&(n==null?void 0:n({eventName:"reaction_open_emoji_picker",extraData:babelHelpers["extends"]({},c("getInstamadilloLoggingExtraData")(b),{message_id:a.messageId}),flowInstanceId:o}))});return function(a){return e.apply(this,arguments)}}())),e()},q=[m,o,n,a.messageId,a.threadKey],f[7]=m,f[8]=o,f[9]=n,f[10]=a.messageId,f[11]=a.threadKey,f[12]=p,f[13]=q):(p=f[12],q=f[13]);p=d("Int64Hooks").useCallbackInt64(p,q);f[14]!==p||f[15]!==k?(q=[l,p,k],f[14]=p,f[15]=k,f[16]=q):q=f[16];return q}g["default"]=a}),226);
__d("useIGDMessageReactionMenuItem.react",["I64","IGDMessageContextMenuItem.react","IGDSBox.react","IGDSFace2OutlineIcon.react","IGDSLazyPopoverTrigger.react","LSBitFlag","LSContactBitOffset","LSMessagingThreadTypeUtil","LSThreadBitOffset","MWLSThread","ReQL","ReQLSuspense","gkx","react","react-compiler-runtime","requireDeferred","useGenAIFeedbackSubmissionStatus","useIGDMessageReaction.react","useIsGenAiFeedbackEnabled","useIsReadOnlyFeatureLimited","useIsThreadBlocked","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||d("react"),l=c("requireDeferred")("IGDComposerEmojiPickerPopover.react").__setRef("useIGDMessageReactionMenuItem.react");function a(a,b){var e=d("react-compiler-runtime").c(15),g=(h||(h=c("useReStore")))(),j=a.displayedContentTypes,m=a.senderId,n=c("useIsThreadBlocked")(),o=d("MWLSThread").useThreadExn(a.threadKey),p=d("LSMessagingThreadTypeUtil").isIGDMessageRequest(o),q=c("useIsReadOnlyFeatureLimited")(),r;e[0]!==g.tables.contacts||e[1]!==m?(r=function(){return d("ReQL").fromTableAscending(g.tables.contacts).getKeyRange(m)},e[0]=g.tables.contacts,e[1]=m,e[2]=r):r=e[2];var s;e[3]!==g||e[4]!==m?(s=[g,m],e[3]=g,e[4]=m,e[5]=s):s=e[5];r=d("ReQLSuspense").useFirst(r,s,f.id+":55");s=d("LSThreadBitOffset").has(18,o);var t=d("LSThreadBitOffset").has(139,o);o=d("LSThreadBitOffset").has(169,o);j=(i||(i=d("I64"))).equal(j,d("LSBitFlag").empty);r=r!=null&&d("LSContactBitOffset").has(66,r);var u=c("useIsGenAiFeedbackEnabled")(a.botResponseId,c("gkx")("664")===!0),v=c("useGenAIFeedbackSubmissionStatus")(a.botResponseId);n=!n&&!r&&!p&&!q&&!a.isUnsent&&!j&&(t?o:s)&&u&&v==null;r=c("useIGDMessageReaction.react")(a,b);var w=r[0],x=r[1];p=r[2];e[6]!==a.threadKey||e[7]!==p?(q=babelHelpers["extends"]({threadKey:a.threadKey},p),e[6]=a.threadKey,e[7]=p,e[8]=q):q=e[8];j=q;if(!n)return null;e[9]!==w||e[10]!==x?(t=function(a,b){return k.jsx(c("IGDSBox.react"),{containerRef:a,children:k.jsx(c("IGDMessageContextMenuItem.react"),{icon:k.jsx(c("IGDSFace2OutlineIcon.react"),{alt:w,size:18}),label:w,onClick:function(){return x(b)}})})},e[9]=w,e[10]=x,e[11]=t):t=e[11];e[12]!==j||e[13]!==t?(o=k.jsx(c("IGDSLazyPopoverTrigger.react"),{align:"start",popoverProps:j,popoverResource:l,popoverType:"dialog",position:"above",children:t}),e[12]=j,e[13]=t,e[14]=o):o=e[14];return o}g["default"]=a}),98);
__d("useIGDMessageReplyMenuItem.react",["I64","IGDInstamadilloUtils","IGDMessageContextMenuItem.react","IGDSReplyPanoOutline24Icon.react","LSBitFlag","LSContactBitOffset","LSMessagingThreadTypeUtil","LSThreadBitOffset","MWLSThread","ReQL","ReQLSuspense","gkx","react","react-compiler-runtime","useGenAIFeedbackSubmissionStatus","useIGDMessageReply.react","useIsGenAiFeedbackEnabled","useIsReadOnlyFeatureLimited","useIsThreadBlocked","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||d("react");function a(a,b){var e=d("react-compiler-runtime").c(12),g=(h||(h=c("useReStore")))(),j=a.displayedContentTypes,l=a.senderId,m=c("useIsThreadBlocked")(),n=d("MWLSThread").useThreadExn(a.threadKey),o=d("LSMessagingThreadTypeUtil").isIGDMessageRequest(n),p=c("useIsReadOnlyFeatureLimited")(),q;e[0]!==g.tables.contacts||e[1]!==l?(q=function(){return d("ReQL").fromTableAscending(g.tables.contacts).getKeyRange(l)},e[0]=g.tables.contacts,e[1]=l,e[2]=q):q=e[2];var r;e[3]!==g||e[4]!==l?(r=[g,l],e[3]=g,e[4]=l,e[5]=r):r=e[5];q=d("ReQLSuspense").useFirst(q,r,f.id+":52");r=d("LSThreadBitOffset").has(42,n);b=c("useIGDMessageReply.react")(a,n,b);var s=b[0];b=b[1];var t=c("useIsGenAiFeedbackEnabled")(a.botResponseId,c("gkx")("664")===!0),u=c("useGenAIFeedbackSubmissionStatus")(a.botResponseId);if(!r||!t)return null;r=(i||(i=d("I64"))).equal(j,d("LSBitFlag").empty);j=q!=null&&d("LSContactBitOffset").has(66,q);q=d("IGDInstamadilloUtils").isIGDDisappearingModeEnabled(n);n=!m&&!j&&!o&&!p&&!a.isUnsent&&!r&&t&&u==null&&d("IGDInstamadilloUtils").shouldRenderMessageReply(a,q);if(!n)return null;e[6]!==b?(m=k.jsx(c("IGDSReplyPanoOutline24Icon.react"),{alt:b,size:18}),e[6]=b,e[7]=m):m=e[7];e[8]!==b||e[9]!==s||e[10]!==m?(j=k.jsx(c("IGDMessageContextMenuItem.react"),{icon:m,label:b,onClick:s}),e[8]=b,e[9]=s,e[10]=m,e[11]=j):j=e[11];return j}g["default"]=a}),98);
__d("IGDMessageReportMenuItem.react",["fbt","IGDMessageContextMenuItem.react","IGDSReportPanoOutline24Icon.react","MWPActor.react","emptyFunction","promiseDone","react","react-compiler-runtime","requireDeferred","useIGDSLazyDialog","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));j.useCallback;var l=c("requireDeferred")("MWLogMessageAction").__setRef("IGDMessageReportMenuItem.react");function a(a){var b=d("react-compiler-runtime").c(13),e=a.dialogProps,f=a.dialogResource,g=a.message,j=d("MWPActor.react").useActor(),m=(i||(i=c("useReStore")))();b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._("__JHASH__iy-oX7MfwVR__JHASH__"),b[0]=a):a=b[0];a=a;f=c("useIGDSLazyDialog")(f);var n=f[0];b[1]!==j||b[2]!==m||b[3]!==e||b[4]!==g.messageId||b[5]!==g.senderId||b[6]!==g.threadKey||b[7]!==n?(f=function(){n(e,c("emptyFunction")),l.onReady(function(a){return c("promiseDone")(a.log(m,g.messageId,g.threadKey,"message_dot_menu","report",void 0,void 0,void 0,g.senderId,void 0,j))})},b[1]=j,b[2]=m,b[3]=e,b[4]=g.messageId,b[5]=g.senderId,b[6]=g.threadKey,b[7]=n,b[8]=f):f=b[8];f=f;var o;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(o=k.jsx(c("IGDSReportPanoOutline24Icon.react"),{alt:a,color:"ig-error-or-destructive",size:18}),b[9]=o):o=b[9];var p;b[10]===Symbol["for"]("react.memo_cache_sentinel")?(p={color:"errorOrDestructive"},b[10]=p):p=b[10];b[11]!==f?(o=k.jsx(c("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:o,label:a,labelProps:p,onClick:f,testid:void 0}),b[11]=f,b[12]=o):o=b[12];return o}g["default"]=a}),226);
__d("useIGDMessageReportMenuItem.react",["I64","IGDMessageReportMenuItem.react","JSResourceForInteraction","LSContactBitOffset","LSIntEnum","LSMessagingThreadTypeUtil","MWPActor.react","ReQL","ReQLSuspense","emptyFunction","getLSMediaContactProfilePictureUrl","react","react-compiler-runtime","useMWBShouldReportThreadAsInstamadillo","usePolarisAnalyticsContext","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=i||d("react"),m=[(j||(j=d("LSIntEnum"))).ofNumber(1),j.ofNumber(16384),j.ofNumber(2),j.ofNumber(4),(k||(k=d("I64"))).add(j.ofNumber(1),j.ofNumber(8192)),k.add(j.ofNumber(16384),j.ofNumber(8192)),k.add(j.ofNumber(2),j.ofNumber(8192)),k.add(j.ofNumber(4),j.ofNumber(8192))];function a(a,b){var e=d("react-compiler-runtime").c(57),g=(h||(h=c("useReStore")))(),i=d("MWPActor.react").useActor(),j=a.displayedContentTypes,n=a.senderId,o;e[0]!==g.tables.contacts||e[1]!==n?(o=function(){return d("ReQL").fromTableAscending(g.tables.contacts).getKeyRange(n)},e[0]=g.tables.contacts,e[1]=n,e[2]=o):o=e[2];var p;e[3]!==g||e[4]!==n?(p=[g,n],e[3]=g,e[4]=n,e[5]=p):p=e[5];o=d("ReQLSuspense").useFirst(o,p,f.id+":64");p=o!=null&&d("LSContactBitOffset").has(18,o);o=(k||(k=d("I64"))).equal(n,i);var q;e[6]!==g.tables.contacts||e[7]!==a.senderId?(q=function(){return d("ReQL").fromTableAscending(g.tables.contacts).getKeyRange(a.senderId)},e[6]=g.tables.contacts,e[7]=a.senderId,e[8]=q):q=e[8];var r;e[9]!==g||e[10]!==a.senderId?(r=[g,a.senderId],e[9]=g,e[10]=a.senderId,e[11]=r):r=e[11];q=d("ReQLSuspense").useFirst(q,r,f.id+":76");e[12]!==g.tables.ig_thread_info||e[13]!==a.threadKey?(r=function(){return d("ReQL").fromTableAscending(g.tables.ig_thread_info).getKeyRange(a.threadKey)},e[12]=g.tables.ig_thread_info,e[13]=a.threadKey,e[14]=r):r=e[14];var s;e[15]!==g||e[16]!==a.threadKey?(s=[g,a.threadKey],e[15]=g,e[16]=a.threadKey,e[17]=s):s=e[17];r=d("ReQLSuspense").useFirst(r,s,f.id+":81");e[18]!==g.tables.threads||e[19]!==a.threadKey?(s=function(){return d("ReQL").fromTableAscending(g.tables.threads).getKeyRange(a.threadKey)},e[18]=g.tables.threads,e[19]=a.threadKey,e[20]=s):s=e[20];var t;e[21]!==g||e[22]!==a.threadKey?(t=[g,a.threadKey],e[21]=g,e[22]=a.threadKey,e[23]=t):t=e[23];s=d("ReQLSuspense").useFirst(s,t,f.id+":89");e[24]!==i||e[25]!==g.tables.mailbox_metadata?(t=function(){return d("ReQL").fromTableAscending(g.tables.mailbox_metadata).getKeyRange(i)},e[24]=i,e[25]=g.tables.mailbox_metadata,e[26]=t):t=e[26];var u;e[27]!==i||e[28]!==g?(u=[g,i],e[27]=i,e[28]=g,e[29]=u):u=e[29];t=d("ReQLSuspense").useFirst(t,u,f.id+":94");u=c("useMWBShouldReportThreadAsInstamadillo")(s);var v=c("usePolarisAnalyticsContext")()+"WWW";p=p&&!o&&m.findIndex(function(a){return(k||(k=d("I64"))).equal(j,a)})!==-1;if(!p||q==null||t==null||r==null||s==null)return null;e[30]!==b?(o=d("LSMessagingThreadTypeUtil").isGroup(b),e[30]=b,e[31]=o):o=e[31];e[32]!==q?(p=c("getLSMediaContactProfilePictureUrl")(q),e[32]=q,e[33]=p):p=e[33];e[34]!==a.senderId?(s=(k||(k=d("I64"))).to_string(a.senderId),e[34]=a.senderId,e[35]=s):s=e[35];q=(b=q.secondaryName)!=null?b:"";e[36]!==u||e[37]!==o||e[38]!==p||e[39]!==s||e[40]!==q?(b={isGroup:o,onClose:c("emptyFunction"),profilePicUrl:p,senderId:s,shouldReportAsInstamadillo:u,username:q},e[36]=u,e[37]=o,e[38]=p,e[39]=s,e[40]=q,e[41]=b):b=e[41];o=b;if(u){p=o;s=a.messageId;e[42]!==a.threadKey?(q=(k||(k=d("I64"))).to_string(a.threadKey),e[42]=a.threadKey,e[43]=q):q=e[43];e[44]!==a.messageId||e[45]!==o||e[46]!==q?(b=babelHelpers["extends"]({},p,{reportedObjectID:s,threadId:q}),e[44]=a.messageId,e[45]=o,e[46]=q,e[47]=b):b=e[47];o=b}else{u=r.igThreadId+"_"+encodeURI(btoa(a.messageId))+"_"+(k||(k=d("I64"))).to_string(t.id);e[48]!==v||e[49]!==o||e[50]!==u||e[51]!==r.igThreadId?(p=babelHelpers["extends"]({},o,{containerModule:v,reportedObjectID:u,threadId:r.igThreadId}),e[48]=v,e[49]=o,e[50]=u,e[51]=r.igThreadId,e[52]=p):p=e[52];o=p}s=o;e[53]===Symbol["for"]("react.memo_cache_sentinel")?(q=c("JSResourceForInteraction")("PolarisDirectReportingMessageModal.react").__setRef("useIGDMessageReportMenuItem.react"),e[53]=q):q=e[53];e[54]!==a||e[55]!==o?(b=l.jsx(c("IGDMessageReportMenuItem.react"),{dialogProps:s,dialogResource:q,message:a}),e[54]=a,e[55]=o,e[56]=b):b=e[56];return b}g["default"]=a}),98);
__d("useIGDMessageTimestampMenuItem.react",["I64","IGDSBox.react","IGDSContextMenuItem.react","IGDSText.react","MWEditedEyebrowLabel.react","MWPDateBreak.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||d("react"),k={container:{paddingBottom:"x18d9i69",paddingEnd:"x1sxyh0",paddingStart:"xurb0ha",paddingTop:"xexx8yu",$$css:!0},containerWithDelimiter:{paddingBottom:"x10b6aqq",paddingEnd:"x1sxyh0",paddingStart:"xurb0ha",paddingTop:"xexx8yu",$$css:!0},editLabel:{marginTop:"xvijh9v",$$css:!0},separator:{paddingEnd:"xg83lxy",paddingStart:"x16hj40l",$$css:!0}};function a(a,b,e){var f=d("react-compiler-runtime").c(17),g;f[0]!==a?(g=(i||(i=d("I64"))).to_float(a),f[0]=a,f[1]=g):g=f[1];f[2]!==g?(a=j.jsx(c("MWPDateBreak.react"),{renderTextWrapper:l,timestamp:g}),f[2]=g,f[3]=a):a=f[3];f[4]!==b?(g=b&&j.jsx(c("IGDSBox.react"),{xstyle:k.editLabel,children:j.jsx(c("IGDSText.react"),{color:"secondaryText",size:"footnote",children:j.jsx(c("MWEditedEyebrowLabel.react"),{separatorStyle:k.separator})})}),f[4]=b,f[5]=g):g=f[5];f[6]!==a||f[7]!==g?(b=j.jsxs(c("IGDSBox.react"),{alignItems:"center",direction:"row",children:[a,g]}),f[6]=a,f[7]=g,f[8]=b):b=f[8];a=e?k.containerWithDelimiter:k.container;f[9]!==b||f[10]!==a?(g=j.jsx(d("IGDSContextMenuItem.react").IGDSContextMenuItem,{title:b,xstyle:a}),f[9]=b,f[10]=a,f[11]=g):g=f[11];f[12]!==e?(b=e?j.jsx("div",{className:"x1y3jaa6 x28ko6u xdj266r x1n0m28w x1e56ztr xp7jhwk"}):null,f[12]=e,f[13]=b):b=f[13];f[14]!==g||f[15]!==b?(a=j.jsxs(c("IGDSBox.react"),{children:[g,b]}),f[14]=g,f[15]=b,f[16]=a):a=f[16];return a}function l(a){return j.jsx(c("IGDSText.react"),{color:"secondaryText",size:"footnote",weight:"semibold",children:a})}l.displayName=l.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("IGDSUndoCirclePanoOutline24Icon.react",["IGDSSVGIconBase.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(4),e,f;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=i.jsx("path",{d:"M12 .5C5.659.5.5 5.66.5 12S5.659 23.5 12 23.5c6.34 0 11.5-5.16 11.5-11.5S18.34.5 12 .5Zm0 21c-5.238 0-9.5-4.262-9.5-9.5S6.762 2.5 12 2.5s9.5 4.262 9.5 9.5-4.262 9.5-9.5 9.5Z"}),f=i.jsx("path",{d:"M14.5 10H9.414l1.293-1.293a1 1 0 1 0-1.414-1.414l-3 2.999a1 1 0 0 0 0 1.414l3 3.001a.997.997 0 0 0 1.414 0 1 1 0 0 0 0-1.414L9.415 12H14.5c.827 0 1.5.674 1.5 1.501 0 .395-.157.794-.431 1.096-.227.249-.508.403-.735.403L14 14.999a1 1 0 0 0-.001 2l.833.001h.002c.796 0 1.604-.386 2.215-1.059a3.625 3.625 0 0 0 .951-2.44C18 11.571 16.43 10 14.5 10Z"}),b[0]=e,b[1]=f):(e=b[0],f=b[1]);b[2]!==a?(e=i.jsxs(c("IGDSSVGIconBase.react"),babelHelpers["extends"]({},a,{viewBox:"0 0 24 24",children:[e,f]})),b[2]=a,b[3]=e):e=b[3];return e}b=i.memo(a);g["default"]=b}),98);
__d("useIGDMessageUnsendMenuItem.react",["fbt","I64","IGDMessageContextMenuItem.react","IGDSUndoCirclePanoOutline24Icon.react","IGDThreadListNewMessageLoggingDataContext","Int64Hooks","JSResourceForInteraction","MWPActor.react","MWPThreadCapabilitiesContext","MessengerWebUXLogger","PolarisDirectLogger","getInstamadilloLoggingExtraData","react","react-compiler-runtime","useIGDSLazyDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||d("react");function a(a,b){var e=d("react-compiler-runtime").c(13),f=d("MWPActor.react").useActor(),g=a.senderId;g=(j||(j=d("I64"))).equal(g,f);var i=c("MessengerWebUXLogger").useInteractionLogger(),l=d("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext();e[0]===Symbol["for"]("react.memo_cache_sentinel")?(f=c("JSResourceForInteraction")("IGDMessageUnsendDialog.react").__setRef("useIGDMessageUnsendMenuItem.react"),e[0]=f):f=e[0];f=c("useIGDSLazyDialog")(f);var m=f[0],n;e[1]!==l||e[2]!==i||e[3]!==a||e[4]!==m||e[5]!==b?(f=function(){i==null?void 0:i({eventName:"message_unsend",extraData:c("getInstamadilloLoggingExtraData")(b),flowInstanceId:l}),m({message:a}),d("PolarisDirectLogger").DirectLogger.logDirectEvent("DirectThread","direct_delete_message_attempt")},n=[l,i,a,m,b],e[1]=l,e[2]=i,e[3]=a,e[4]=m,e[5]=b,e[6]=f,e[7]=n):(f=e[6],n=e[7]);f=d("Int64Hooks").useCallbackInt64(f,n);n=d("MWPThreadCapabilitiesContext").useMWPThreadCapabilitiesContext();n=n.messageUnsendEnabled;if(!n||!g)return null;e[8]===Symbol["for"]("react.memo_cache_sentinel")?(n=h._("__JHASH__H8A15z0PXSW__JHASH__"),e[8]=n):n=e[8];g=n;e[9]===Symbol["for"]("react.memo_cache_sentinel")?(n=k.jsx(c("IGDSUndoCirclePanoOutline24Icon.react"),{alt:g,color:"ig-error-or-destructive",size:18}),e[9]=n):n=e[9];var o;e[10]===Symbol["for"]("react.memo_cache_sentinel")?(o={color:"errorOrDestructive"},e[10]=o):o=e[10];e[11]!==f?(n=k.jsx(c("IGDMessageContextMenuItem.react"),{delimiter:!0,icon:n,label:g,labelProps:o,onClick:f}),e[11]=f,e[12]=n):n=e[12];return n}g["default"]=a}),226);
__d("IGDMessageContextMenu.react",["IGDBroadcastChannelLoggingShapes","IGDSBox.react","IGDSPopover.react","IGDThreadListNewMessageLoggingDataContext","MWCMThreadTypes.react","MessengerWebUXLogger","WebUXLoggingSurfaceContextProvider","isMWEditedMessage","react","react-compiler-runtime","useIGDBroadcastChannelImpressionLoggerWithCheck","useIGDEditMessageMenuItem.react","useIGDMessageCopyMenuItem.react","useIGDMessageForwardMenuItem.react","useIGDMessageInspectMenuItem.react","useIGDMessageNegativeFeedbackMenuItem.react","useIGDMessagePositiveFeedbackMenuItem.react","useIGDMessageReactionMenuItem.react","useIGDMessageReplyMenuItem.react","useIGDMessageReportMenuItem.react","useIGDMessageTimestampMenuItem.react","useIGDMessageUnsendMenuItem.react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));h.useMemo;var j={popover:{borderTopStartRadius:"x1ykpwxx",borderTopEndRadius:"x118zf8b",borderBottomEndRadius:"xnwxkdh",borderBottomStartRadius:"xfocsrx",marginBottom:"xu06os2",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(25),e=a.message,f=a.onClose;a=a.thread;var g=d("MWCMThreadTypes.react").isIGBroadcastChannelThread(a.threadSubtype),h=c("useIGDBroadcastChannelImpressionLoggerWithCheck")(e.threadKey,a.threadSubtype,d("IGDBroadcastChannelLoggingShapes").MESSAGE_OPTIONS_RENDERED_SHAPE),l=d("IGDThreadListNewMessageLoggingDataContext").useFlowInstanceIdContext(),m;b[0]!==l?(m={eventName:"message_contextual_menu_rendered",flowInstanceId:l},b[0]=l,b[1]=m):m=b[1];l=c("MessengerWebUXLogger").useImpressionLoggerRef(m);m=c("useIGDMessageReplyMenuItem.react")(e,f);var n=c("useIGDMessageReactionMenuItem.react")(e,f),o=c("useIGDEditMessageMenuItem.react")(e,f,a),p=c("useIGDMessageCopyMenuItem.react")(e,f,a),q=c("useIGDMessageForwardMenuItem.react")(e,f);f=c("useIGDMessagePositiveFeedbackMenuItem.react")(e,f);var r=c("useIGDMessageNegativeFeedbackMenuItem.react")(e),s;b[2]!==p||b[3]!==o||b[4]!==q||b[5]!==r||b[6]!==f||b[7]!==n||b[8]!==m?(s=[n,m,o,q,p,f,r],b[2]=p,b[3]=o,b[4]=q,b[5]=r,b[6]=f,b[7]=n,b[8]=m,b[9]=s):s=b[9];p=s;b[10]!==p?(o=p.filter(Boolean),b[10]=p,b[11]=o):o=b[11];q=o;r=q;b[12]!==e?(f=c("isMWEditedMessage")(e),b[12]=e,b[13]=f):f=b[13];n=f;m=c("useIGDMessageTimestampMenuItem.react")(e.timestampMs,n,r.length>0);s=c("useIGDMessageUnsendMenuItem.react")(e,a);p=c("useIGDMessageReportMenuItem.react")(e,a.threadType);o=c("useIGDMessageInspectMenuItem.react")(e);b[14]!==r?(q=r.map(k),b[14]=r,b[15]=q):q=b[15];b[16]!==o||b[17]!==p||b[18]!==q||b[19]!==m||b[20]!==s?(f=i.jsx(d("WebUXLoggingSurfaceContextProvider").WebUXSurfaceLoggingContext.Provider,{value:"thread_view_message_options",children:i.jsxs(c("IGDSBox.react"),{minWidth:180,padding:2,children:[m,q,s,p,o]})}),b[16]=o,b[17]=p,b[18]=q,b[19]=m,b[20]=s,b[21]=f):f=b[21];n=f;a=g?h:l;b[22]!==n||b[23]!==a?(e=i.jsx(c("IGDSPopover.react"),{popoverContent:n,popoverXStyle:j.popover,ref:a}),b[22]=n,b[23]=a,b[24]=e):e=b[24];return e}function k(a,b){return i.jsx(c("IGDSBox.react"),{children:a},"igd-message-menu-item-"+b)}k.displayName=k.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LSOnSendMessageFailure.nop",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d,e){return(g||(g=b("Promise"))).resolve()}f["default"]=a}),66);
__d("LSMarkOptimisticMessageFailed",["LSOnSendMessageFailure.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return a[2]===!0?d[0]=c.i64.cast([0,5]):d[0]=c.i64.cast([0,4]),a[2]===!0?d[1]=c.i64.cast([0,5]):d[1]=c.i64.cast([0,4]),a[2]===!0?d[2]=c.i64.cast([0,5]):d[2]=c.i64.cast([0,4]),c.nativeOperation(b("LSOnSendMessageFailure.nop"),a[0],a[1])},function(b){return c.forEach(c.filter(c.db.table(12).fetch([[[a[0]]],"optimistic"]),function(b){return b.offlineThreadingId===a[0]&&c.i64.eq(b.authorityLevel,c.i64.cast([0,20]))}),function(a){var b=a.update;a.item;return b({sendStatus:d[0],sendStatusV2:d[1]})})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxMarkOptimisticMessageFailedStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSMarkOptimisticMessageFailedStoredProcedure",["LSMarkOptimisticMessageFailed","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e=c("LSMarkOptimisticMessageFailed")(e.optimisticMid,e.errorMessage,e.isRetryable,a);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e))}g["default"]=a}),98);
__d("MAWMarkMessageSendAsFailedLSDB",["LSFactory","LSMarkOptimisticMessageFailedStoredProcedure","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,d,e,f,g){return(d=f==null?void 0:f.runInTransaction(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield c("LSMarkOptimisticMessageFailedStoredProcedure")(c("LSFactory")(b),{errorMessage:e,isRetryable:g,optimisticMid:a})});return function(a){return d.apply(this,arguments)}}(),"readwrite"))!=null?d:(h||(h=b("Promise"))).resolve()}g.markMessageSendAsFailed=a}),98);
__d("getSendProfileToInstamadilloRecipient",["fbt","FBLogger","I64","IGDDataclassTypes.flow","LSAuthorityLevel","LSMessageReplySourceTypeV2","LSMessageSendStatus","asyncToGeneratorRuntime","issueSendInstamadilloXMAReceiverFetch","renderInstamadilloOptimisticXmaReceiverFetch"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function a(a,e,f,g,j){if(f==null)throw c("FBLogger")("igd_web_on_msgr").mustfix("getSendProfileToInstamadilloRecipient: missing profileUsername");var k={__typename:"XMSGIgReceiverFetchXmaProfileFetchParams",igid:a};a={__typename:"XMSGIgXmaContentRefDataclass",action_type:d("IGDDataclassTypes.flow").XmsgIgXmaActionType.Share,content_type:d("IGDDataclassTypes.flow").XmsgIgReceiverFetchContentType.Profile,fetch_params:k,owner_fbid:e,target_url:g,username:f};var l={contentRef:JSON.stringify(a)},m={authorityLevel:(i||(i=d("I64"))).of_int32(c("LSAuthorityLevel").OPTIMISTIC),isForwarded:j,replySourceTypeV2:j===!0?(i||(i=d("I64"))).of_int32(c("LSMessageReplySourceTypeV2").FORWARD):void 0,sendStatus:i.of_int32(c("LSMessageSendStatus").SENDING_TO_SERVER),sendStatusV2:i.of_int32(1)},n={actionUrl:g,nativeUrl:g,type_:"xma_open_native"},o={authorityLevel:i.of_int32(c("LSAuthorityLevel").OPTIMISTIC),subtitleText:h._("__JHASH__oJkS7J3NeUp__JHASH__").toString(),titleText:f};return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d,e,f,g){try{var h=(yield c("renderInstamadilloOptimisticXmaReceiverFetch")(a,l,k,o,n,m));yield c("issueSendInstamadilloXMAReceiverFetch")({comment:e,isDisappearingModeSettingOn:b,offlineThreadingId:h,openEb:d,receiverFetchXma:JSON.stringify(l),threadKey:a});f==null?void 0:f(a)}catch(b){g==null?void 0:g(b,a)}});return function(b,c,d,e,f,g){return a.apply(this,arguments)}}()}g["default"]=a}),226);