;/*FB_PKG_DELIM*/

__d("useAttachmentDataLS",["I64","ReQL","ReQLSuspense","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b,e=(i||(i=c("useReStore")))(),g=d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(e.tables.attachments).getKeyRange(a.threadKey,a.messageId).map(function(a){var b=j(e,a);return{attachment:a,attachmentCTAs:b}})},[a,e],f.id+":41").toSorted(function(a,b){return(h||(h=d("I64"))).compare(a.attachment.attachmentIndex,b.attachment.attachmentIndex)}),k=(b=g[0])==null?void 0:b.attachment;b=d("ReQLSuspense").useArray(function(){return k==null?d("ReQL").empty():d("ReQL").fromTableAscending(e.tables.attachment_items).getKeyRange(k.attachmentFbid).map(function(a){var b=j(e,a);return{attachmentItem:a,attachmentItemCTAs:b}})},[k,e],f.id+":60").reduce(function(a,b){var c=b.attachmentItem;b=b.attachmentItemCTAs;a[0].push(c);a[1].push(b);return a},[[],[]]);var l=b[0];b=b[1];var m=[];g.map(function(a){m.push(a.attachment)});if(l.length>0)b=b;else{g=(g=g[0])==null?void 0:g.attachmentCTAs;b=g?[g]:[]}return{attachmentCTAs:b,attachmentItems:l,attachments:m}}function j(a,b){var c={},e=b.attachmentCta1Id,g=b.attachmentCta2Id,h=b.attachmentCta3Id;b=b.defaultCtaId;c.defaultCta=b?d("ReQLSuspense").first(d("ReQL").fromTableAscending(a.tables.attachment_ctas).getKeyRange(b),f.id+":112"):void 0;c.attachmentCta1=e?d("ReQLSuspense").first(d("ReQL").fromTableAscending(a.tables.attachment_ctas).getKeyRange(e),f.id+":117"):void 0;c.attachmentCta2=g?d("ReQLSuspense").first(d("ReQL").fromTableAscending(a.tables.attachment_ctas).getKeyRange(g),f.id+":124"):void 0;c.attachmentCta3=h?d("ReQLSuspense").first(d("ReQL").fromTableAscending(a.tables.attachment_ctas).getKeyRange(h),f.id+":131"):void 0;return c}g.useAttachmentDataLS=a}),98);
__d("useAttachmentData",["CometLruCache","I64","MAWMsg","MWPActor.react","cr:318","cr:6851","qex","shouldUseImageGrouping","useAttachmentDataLS","useMAWSeparateReadsSelector"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CometLruCache").create(50);function j(a,b,e,f){var g;if(!((g=c("qex")._("60"))!=null?g:!1))return!1;if(!b)return!1;if(!d("MAWMsg").isMediaMsg(a))return!1;g=c("shouldUseImageGrouping")(a,b);if(g)return!1;if(d("MAWMsg").isOptimistic(a)){i.set(a.offlineThreadingId,!0);return!1}return e&&f==null&&i.get(a.offlineThreadingId)===!0?!1:!0}function a(a,c){var e=d("MWPActor.react").useActor();e=(h||(h=d("I64"))).equal(a.senderId,e);var f=d("useAttachmentDataLS").useAttachmentDataLS(a),g=f.attachmentCTAs,i=f.attachmentItems;f=f.attachments;var k=b("cr:318")(a,c),l=b("cr:6851")(a,c);l=d("MAWMsg").isReceiverFetchMsg(a)?l:k;k=d("useMAWSeparateReadsSelector").useMAWSeparateReadsArraySelector("Attachment",(k=l)!=null?k:[],f,j(a,c,e,l),function(a,b){return a.attachmentFbid.localeCompare(b.attachmentFbid)});return{attachmentCTAs:g,attachmentItems:i,attachments:k}}g.useAttachmentData=a}),98);
__d("MWPAttachmentDataContext",["FBLogger","I64","ReQL","ReQLSuspense","react","useAttachmentData","useAttachmentDataLS","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||(j=d("react")),l=j,m=l.createContext,n=l.useContext,o=m({attachmentCTAs:[],attachmentItems:[],attachments:[]});function a(a){var b=a.children,c=a.isSecureMessage;a=a.message;a=d("useAttachmentData").useAttachmentData(a,c);return k.jsx(o.Provider,{value:a,children:b})}a.displayName=a.name+" [from "+f.id+"]";function b(a){var b=a.children;a=a.message;a=d("useAttachmentDataLS").useAttachmentDataLS(a);return k.jsx(o.Provider,{value:a,children:b})}b.displayName=b.name+" [from "+f.id+"]";function e(a){var b=n(o).attachments;a=p(a);if(b.length===0&&a.length>0){c("FBLogger")("messenger_web_media","attachment_context_missing").warn("MWPAttachmentContext is not set, failed to retrieve attachments");return a}return b}function p(a){var b=(h||(h=c("useReStore")))(),e=a.messageId,g=a.threadKey;return d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(b.tables.attachments).getKeyRange(g,e)},[b,e,g],f.id+":91").sort(function(a,b){return(i||(i=d("I64"))).compare(a.attachmentIndex,b.attachmentIndex)})}function q(a){var b=(i||(i=d("I64"))).to_int32(a.attachmentIndex);b=(b=n(o).attachmentCTAs[b])!=null?b:{};a=r(a);if((b==null?void 0:b.defaultCta)==null&&(a==null?void 0:a.defaultCta)!=null||(b==null?void 0:b.attachmentCta1)==null&&(a==null?void 0:a.attachmentCta1)!=null){c("FBLogger")("messenger_web_media","attachment_context_missing").warn("MWPAttachmentContext is not set, failed to retrieve attachmentCTAs");return a}return b}function r(a){var b=(h||(h=c("useReStore")))(),d={};d.defaultCta=s(b,a==null?void 0:a.defaultCtaId);d.attachmentCta1=s(b,a==null?void 0:a.attachmentCta1Id);d.attachmentCta2=s(b,a==null?void 0:a.attachmentCta2Id);d.attachmentCta3=s(b,a==null?void 0:a.attachmentCta3Id);return d}function s(a,b){return d("ReQLSuspense").useFirst(function(){return b!=null?d("ReQL").fromTableAscending(a.tables.attachment_ctas).getKeyRange(b):d("ReQL").empty()},[a,b],f.id+":143")}function t(a){var b;b=(b=n(o).attachmentItems)!=null?b:[];a=u(a);if(b.length===0&&a.length>0){c("FBLogger")("messenger_web_media","attachment_context_missing").warn("MWPAttachmentContext is not set, failed to retrieve attachmentItems");return a}return b}function u(a){var b=(h||(h=c("useReStore")))();return d("ReQLSuspense").useArray(function(){var c=a.attachmentFbid;return d("ReQL").fromTableAscending(b.tables.attachment_items).getKeyRange(c)},[a,b],f.id+":173")}g.MWPAttachmentDataContext=o;g.MWPAttachmentDataContextProvider=a;g.MWPAttachmentDataContextProviderLS=b;g.useMWPGetAttachments=e;g.useMWPGetAttachmentCTAs=q;g.useMWPGetAttachmentItems=t}),98);
__d("withCometPlaceholder",["CometPlaceholder.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");a=function(a,b,d){b===void 0&&(b=null);return function(e){return i.jsx(c("CometPlaceholder.react"),{fallback:b,name:d,children:i.jsx(a,babelHelpers["extends"]({},e))})}};g.withCometPlaceholder=a}),98);